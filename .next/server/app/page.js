(()=>{var e={};e.id=931,e.ids=[931],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4770:e=>{"use strict";e.exports=require("crypto")},665:e=>{"use strict";e.exports=require("dns")},7702:e=>{"use strict";e.exports=require("events")},2048:e=>{"use strict";e.exports=require("fs")},2615:e=>{"use strict";e.exports=require("http")},2694:e=>{"use strict";e.exports=require("http2")},8216:e=>{"use strict";e.exports=require("net")},9801:e=>{"use strict";e.exports=require("os")},5315:e=>{"use strict";e.exports=require("path")},5816:e=>{"use strict";e.exports=require("process")},6162:e=>{"use strict";e.exports=require("stream")},4026:e=>{"use strict";e.exports=require("string_decoder")},2452:e=>{"use strict";e.exports=require("tls")},7360:e=>{"use strict";e.exports=require("url")},1764:e=>{"use strict";e.exports=require("util")},1568:e=>{"use strict";e.exports=require("zlib")},8061:e=>{"use strict";e.exports=require("node:assert")},2761:e=>{"use strict";e.exports=require("node:async_hooks")},2254:e=>{"use strict";e.exports=require("node:buffer")},27:e=>{"use strict";e.exports=require("node:console")},6005:e=>{"use strict";e.exports=require("node:crypto")},5714:e=>{"use strict";e.exports=require("node:diagnostics_channel")},5673:e=>{"use strict";e.exports=require("node:events")},8849:e=>{"use strict";e.exports=require("node:http")},2725:e=>{"use strict";e.exports=require("node:http2")},7503:e=>{"use strict";e.exports=require("node:net")},8846:e=>{"use strict";e.exports=require("node:perf_hooks")},5815:e=>{"use strict";e.exports=require("node:querystring")},4492:e=>{"use strict";e.exports=require("node:stream")},9516:e=>{"use strict";e.exports=require("node:tls")},1041:e=>{"use strict";e.exports=require("node:url")},7261:e=>{"use strict";e.exports=require("node:util")},3746:e=>{"use strict";e.exports=require("node:util/types")},4086:e=>{"use strict";e.exports=require("node:worker_threads")},5628:e=>{"use strict";e.exports=require("node:zlib")},2576:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>l.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>d,routeModule:()=>u,tree:()=>o}),t(908),t(1506),t(6560);var r=t(3191),a=t(8716),i=t(7922),l=t.n(i),n=t(5231),c={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>n[e]);t.d(s,c);let o=["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,908)),"C:\\NB\\showAI_V3\\app\\page.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,1506)),"C:\\NB\\showAI_V3\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,6560)),"C:\\NB\\showAI_V3\\app\\not-found.tsx"]}],d=["C:\\NB\\showAI_V3\\app\\page.tsx"],x="/page",m={require:t,loadChunk:()=>Promise.resolve()},u=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},824:(e,s,t)=>{Promise.resolve().then(t.bind(t,3485))},3485:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>q});var r=t(326),a=t(7577),i=t(76),l=t(4036),n=t(709),c=t(7553),o=t(902),d=t(464);function x({selectedClientId:e,onClientSelect:s,showDropdown:t,onToggleDropdown:i}){let[l,n]=(0,a.useState)([]),[c,o]=(0,a.useState)(!0),[x,m]=(0,a.useState)(""),{user:u}=(0,d.a)(),h=l.find(s=>s.id===e),p=l.filter(e=>!x||e.name.toLowerCase().includes(x.toLowerCase())||e.email.toLowerCase().includes(x.toLowerCase())||e.tags.some(e=>e.toLowerCase().includes(x.toLowerCase()))),g=e=>{s(e),i(),m("")},y=e=>{switch(e){case"Hot Lead":return"bg-red-900/30 text-red-300 border-red-700/50";case"Active":return"bg-green-900/30 text-green-300 border-green-700/50";default:return"bg-gray-700/50 text-gray-400 border-gray-600/50"}};return(0,r.jsxs)("div",{className:"relative",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Select Client (Optional)"}),(0,r.jsxs)("button",{type:"button",onClick:i,className:"w-full px-4 py-3 border border-gray-700 rounded-lg bg-gray-800 text-white text-left focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm flex items-center justify-between",children:[r.jsx("div",{className:"flex-1",children:h?(0,r.jsxs)("div",{children:[r.jsx("div",{className:"text-white",children:h.name}),(0,r.jsxs)("div",{className:"text-xs text-gray-400 mt-1 flex items-center space-x-2",children:[r.jsx("span",{children:h.email}),r.jsx("span",{children:"•"}),r.jsx("span",{className:`px-1.5 py-0.5 rounded-full text-xs ${y(h.status)}`,children:h.status})]}),h.tags.length>0&&(0,r.jsxs)("div",{className:"flex flex-wrap gap-1 mt-1",children:[h.tags.slice(0,2).map((e,s)=>r.jsx("span",{className:"px-1.5 py-0.5 bg-purple-900/20 text-purple-400 rounded text-xs",children:e},s)),h.tags.length>2&&(0,r.jsxs)("span",{className:"px-1.5 py-0.5 bg-gray-700 text-gray-400 rounded text-xs",children:["+",h.tags.length-2]})]})]}):r.jsx("span",{className:"text-gray-400",children:"Select an existing client or create new..."})}),r.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:r.jsx("i",{className:`ri-arrow-${t?"up":"down"}-s-line text-gray-400`})})]}),t&&(0,r.jsxs)("div",{className:"absolute top-full left-0 right-0 mt-1 bg-gray-800 border border-gray-700 rounded-lg shadow-lg z-10 max-h-64 overflow-y-auto",children:[r.jsx("div",{className:"p-3 border-b border-gray-700",children:r.jsx("input",{type:"text",value:x,onChange:e=>m(e.target.value),placeholder:"Search clients...",className:"w-full px-3 py-2 border border-gray-700 rounded-lg bg-gray-800 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})}),r.jsx("div",{className:"max-h-48 overflow-y-auto",children:c?r.jsx("div",{className:"px-4 py-3 text-gray-400 text-sm",children:"Loading clients..."}):0===p.length?r.jsx("div",{className:"px-4 py-3 text-gray-400 text-sm",children:x?"No matching clients found":"No clients found. Create clients first."}):r.jsx(r.Fragment,{children:p.map(s=>(0,r.jsxs)("button",{type:"button",onClick:()=>g(s),className:`w-full px-4 py-3 text-left hover:bg-gray-700 transition-colors text-sm cursor-pointer border-b border-gray-700 last:border-b-0 ${e===s.id?"bg-blue-900/30":""}`,children:[r.jsx("div",{className:"text-white",children:s.name}),(0,r.jsxs)("div",{className:"text-xs text-gray-400 mt-1 flex items-center space-x-2",children:[r.jsx("span",{children:s.email}),r.jsx("span",{children:"•"}),r.jsx("span",{className:`px-1.5 py-0.5 rounded-full text-xs ${y(s.status)}`,children:s.status})]}),s.tags.length>0&&(0,r.jsxs)("div",{className:"flex flex-wrap gap-1 mt-1",children:[s.tags.slice(0,2).map((e,s)=>r.jsx("span",{className:"px-1.5 py-0.5 bg-purple-900/20 text-purple-400 rounded text-xs",children:e},s)),s.tags.length>2&&(0,r.jsxs)("span",{className:"px-1.5 py-0.5 bg-gray-700 text-gray-400 rounded text-xs",children:["+",s.tags.length-2]})]})]},s.id))})}),h&&r.jsx("div",{className:"p-3 border-t border-gray-700",children:r.jsx("button",{type:"button",onClick:()=>{s(null),i(),m("")},className:"w-full px-3 py-2 text-red-400 hover:text-red-300 text-sm transition-colors cursor-pointer",children:"Clear Selection"})})]})]})}var m=t(4321);let u=["In-Person","Virtual","Open House","Follow-up Call"];function h({onSubmit:e,loading:s}){let[t,l]=(0,a.useState)(""),[n,c]=(0,a.useState)(""),[h,p]=(0,a.useState)(""),[g,y]=(0,a.useState)([]),[j,f]=(0,a.useState)(""),[b,N]=(0,a.useState)([]),[v,w]=(0,a.useState)(!1),[S,C]=(0,a.useState)(""),[k,A]=(0,a.useState)("In-Person"),[D,T]=(0,a.useState)(!1),[R,P]=(0,a.useState)(""),[E,I]=(0,a.useState)(""),[$,F]=(0,a.useState)(!1),{user:q}=(0,d.a)(),O=async s=>{if(s.preventDefault(),t.trim()&&n.trim()&&j&&D){let s=b.find(e=>e.id===j);if(s){let r={address:s.address,propertyType:s.propertyType||"Single Family",price:s.price||0,bedrooms:s.bedrooms||0,bathrooms:s.bathrooms||0,sqft:s.sqft||0,lotSize:s.lotSize,yearBuilt:s.yearBuilt,parking:s.parking,propertyFeatures:s.propertyFeatures||[],status:s.status||"Active",images:s.images||[]};if(console.log("\uD83C\uDFE0 ENHANCED PROPERTY CONTEXT FOR AI:",r),q?.uid)try{let a={client:{name:t.trim(),email:n.trim(),phone:h.trim()},propertyId:s.id,propertyAddress:s.address,tags:g,notes:S.trim()||null,sessionType:k,consentGiven:D,scheduledAt:R?new Date(R):null,createdAt:(0,i.Bt)(),userId:q.uid,status:"initialized"};console.log("Client data being saved:",a);let l=await (0,i.ET)((0,i.hJ)(o.db,"sessions"),a);console.log("✅ Session saved to Firestore:",l.id),e({clientName:t.trim(),clientEmail:n.trim(),clientPhone:h.trim(),tags:g,propertyAddress:s.address,propertyId:s.id,propertyContext:r,agentNotes:S.trim()||void 0,sessionType:k,consentGiven:D,scheduledAt:R?new Date(R):void 0,selectedClientId:E||void 0})}catch(e){console.error("❌ Error saving session:",e),alert("Failed to save session data. Please try again.")}}}},U=e=>{f(e.id),w(!1)},B=b.find(e=>e.id===j),M=t.trim()&&n.trim()&&j&&D;return(0,r.jsxs)("form",{onSubmit:O,className:"space-y-4",children:[r.jsx("div",{className:"bg-blue-900/20 border border-blue-700/50 rounded-lg p-4 mb-6",children:(0,r.jsxs)("div",{className:"flex items-start space-x-3",children:[r.jsx("div",{className:"w-5 h-5 flex items-center justify-center mt-0.5",children:r.jsx("i",{className:"ri-mic-line text-blue-400"})}),(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-blue-300 text-sm font-medium mb-1",children:"\uD83C\uDF99️ For best results:"}),r.jsx("p",{className:"text-blue-200 text-sm",children:"Ensure your microphone is clear and background noise is minimal."})]})]})}),r.jsx(x,{selectedClientId:E,onClientSelect:e=>{e?(I(e.id),l(e.name),c(e.email),p(e.phone||""),y(e.tags)):(I(""),l(""),c(""),p(""),y([]))},showDropdown:$,onToggleDropdown:()=>F(!$)}),(0,r.jsxs)("div",{children:[r.jsx("label",{htmlFor:"clientName",className:"block text-sm font-medium text-gray-300 mb-2",children:"Client Name *"}),r.jsx("input",{type:"text",id:"clientName",value:t,onChange:e=>l(e.target.value),className:"w-full px-4 py-3 border border-gray-700 rounded-lg bg-gray-800 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",placeholder:"Enter client name",required:!0})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{htmlFor:"clientEmail",className:"block text-sm font-medium text-gray-300 mb-2",children:"Client Email *"}),r.jsx("input",{type:"email",id:"clientEmail",value:n,onChange:e=>c(e.target.value),className:"w-full px-4 py-3 border border-gray-700 rounded-lg bg-gray-800 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",placeholder:"client@example.com",required:!0})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{htmlFor:"clientPhone",className:"block text-sm font-medium text-gray-300 mb-2",children:"Client Phone"}),r.jsx("input",{type:"tel",id:"clientPhone",value:h,onChange:e=>p(e.target.value),className:"w-full px-4 py-3 border border-gray-700 rounded-lg bg-gray-800 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",placeholder:"+1 (555) 123-4567"})]}),r.jsx(m.Z,{value:g,onChange:y,placeholder:"first-time buyer, budget-conscious, family",label:"Tags"}),(0,r.jsxs)("div",{children:[r.jsx("label",{htmlFor:"agentNotes",className:"block text-sm font-medium text-gray-300 mb-2",children:"Agent Notes (Optional)"}),r.jsx("textarea",{id:"agentNotes",value:S,onChange:e=>C(e.target.value.slice(0,1e3)),rows:3,className:"w-full px-4 py-3 border border-gray-700 rounded-lg bg-gray-800 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm resize-none",placeholder:"Include any special instructions or client context to improve the AI analysis...",maxLength:1e3}),(0,r.jsxs)("div",{className:"flex justify-between items-center mt-1",children:[r.jsx("p",{className:"text-xs text-gray-500",children:"Special instructions or context for better AI analysis"}),(0,r.jsxs)("span",{className:"text-xs text-gray-500",children:[S.length,"/1000"]})]})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{htmlFor:"sessionType",className:"block text-sm font-medium text-gray-300 mb-2",children:"Session Type"}),r.jsx("select",{id:"sessionType",value:k,onChange:e=>A(e.target.value),className:"w-full px-4 py-3 pr-8 border border-gray-700 rounded-lg bg-gray-800 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",children:u.map(e=>r.jsx("option",{value:e,className:"bg-gray-800",children:e},e))})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{htmlFor:"scheduledAt",className:"block text-sm font-medium text-gray-300 mb-2",children:"Session Date (Optional)"}),r.jsx("input",{type:"datetime-local",id:"scheduledAt",value:R,onChange:e=>P(e.target.value),className:"w-full px-4 py-3 border border-gray-700 rounded-lg bg-gray-800 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Leave empty if recording right now"})]}),(0,r.jsxs)("div",{className:"relative",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Property Address *"}),(0,r.jsxs)("button",{type:"button",onClick:()=>w(!v),className:"w-full px-4 py-3 border border-gray-700 rounded-lg bg-gray-800 text-white text-left focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm flex items-center justify-between",children:[r.jsx("div",{className:"flex-1",children:B?(0,r.jsxs)("div",{children:[r.jsx("div",{className:"text-white",children:B.address}),(0,r.jsxs)("div",{className:"text-xs text-gray-400 mt-1 flex items-center space-x-2",children:[r.jsx("span",{children:B.propertyType}),r.jsx("span",{children:"•"}),(0,r.jsxs)("span",{children:["$",B.price?.toLocaleString()]}),r.jsx("span",{children:"•"}),r.jsx("span",{className:`px-1.5 py-0.5 rounded-full text-xs ${"Active"===B.status?"bg-green-900/30 text-green-300":"Coming Soon"===B.status?"bg-yellow-900/30 text-yellow-300":"bg-red-900/30 text-red-300"}`,children:B.status})]}),B.propertyFeatures&&B.propertyFeatures.length>0&&(0,r.jsxs)("div",{className:"flex flex-wrap gap-1 mt-1",children:[B.propertyFeatures.slice(0,3).map((e,s)=>r.jsx("span",{className:"px-1.5 py-0.5 bg-blue-900/20 text-blue-400 rounded text-xs",children:e},s)),B.propertyFeatures.length>3&&(0,r.jsxs)("span",{className:"px-1.5 py-0.5 bg-gray-700 text-gray-400 rounded text-xs",children:["+",B.propertyFeatures.length-3]})]})]}):r.jsx("span",{className:"text-gray-400",children:"Select a property..."})}),r.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:r.jsx("i",{className:`ri-arrow-${v?"up":"down"}-s-line text-gray-400`})})]}),v&&r.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-gray-800 border border-gray-700 rounded-lg shadow-lg z-10 max-h-64 overflow-y-auto",children:0===b.length?r.jsx("div",{className:"px-4 py-3 text-gray-400 text-sm",children:"No properties found. Add properties first."}):b.map(e=>(0,r.jsxs)("button",{type:"button",onClick:()=>U(e),className:"w-full px-4 py-3 text-left hover:bg-gray-700 transition-colors text-sm cursor-pointer border-b border-gray-700 last:border-b-0",children:[r.jsx("div",{className:"text-white",children:e.address}),(0,r.jsxs)("div",{className:"text-xs text-gray-400 mt-1 flex items-center space-x-2",children:[r.jsx("span",{children:e.propertyType}),r.jsx("span",{children:"•"}),(0,r.jsxs)("span",{children:["$",e.price?.toLocaleString()]}),r.jsx("span",{children:"•"}),r.jsx("span",{className:`px-1.5 py-0.5 rounded-full text-xs ${"Active"===e.status?"bg-green-900/30 text-green-300":"Coming Soon"===e.status?"bg-yellow-900/30 text-yellow-300":"bg-red-900/30 text-red-300"}`,children:e.status})]}),e.propertyFeatures&&e.propertyFeatures.length>0&&(0,r.jsxs)("div",{className:"flex flex-wrap gap-1 mt-1",children:[e.propertyFeatures.slice(0,2).map((e,s)=>r.jsx("span",{className:"px-1.5 py-0.5 bg-blue-900/20 text-blue-400 rounded text-xs",children:e},s)),e.propertyFeatures.length>2&&(0,r.jsxs)("span",{className:"px-1.5 py-0.5 bg-gray-700 text-gray-400 rounded text-xs",children:["+",e.propertyFeatures.length-2]})]})]},e.id))})]}),r.jsx("div",{className:"bg-yellow-900/20 border border-yellow-700/50 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-start space-x-3",children:[r.jsx("input",{type:"checkbox",id:"consentGiven",checked:D,onChange:e=>T(e.target.checked),className:"mt-1 w-4 h-4 text-blue-600 bg-gray-800 border-gray-600 rounded focus:ring-blue-500 focus:ring-2",required:!0}),(0,r.jsxs)("label",{htmlFor:"consentGiven",className:"text-sm text-yellow-200",children:[r.jsx("span",{className:"font-medium",children:"✅ I have received consent from the client to record this session."}),r.jsx("p",{className:"text-xs text-yellow-300 mt-1",children:"Required before starting any recording session"})]})]})}),r.jsx("button",{type:"submit",disabled:s||!M,className:"w-full py-3 px-4 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-800 disabled:opacity-50 text-white font-medium rounded-lg transition-colors cursor-pointer whitespace-nowrap flex items-center justify-center space-x-2",children:s?(0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),r.jsx("span",{children:"Processing..."})]}):(0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:r.jsx("i",{className:"ri-mic-line"})}),r.jsx("span",{children:"Start Recording"})]})}),!D&&r.jsx("p",{className:"text-xs text-red-400 text-center",children:"Please confirm you have client consent before proceeding"})]})}let p=()=>{let[e,s]=(0,a.useState)(!1),[t,r]=(0,a.useState)(0),[i,l]=(0,a.useState)(null),n=(0,a.useRef)(null),c=(0,a.useRef)(null),o=(0,a.useRef)(null);return{isRecording:e,recordingTime:t,audioBlob:i,startRecording:async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0});c.current=e;let t=new MediaRecorder(e);n.current=t;let a=[];t.ondataavailable=e=>{a.push(e.data)},t.onstop=()=>{let e=new Blob(a,{type:"audio/wav"});l(e)},t.start(),s(!0),r(0),o.current=setInterval(()=>{r(e=>e+1)},1e3)}catch(e){throw console.error("Error starting recording:",e),e}},stopRecording:()=>{n.current&&n.current.stop(),c.current&&c.current.getTracks().forEach(e=>e.stop()),o.current&&clearInterval(o.current),s(!1)},resetRecording:()=>{l(null),r(0)},formatTime:e=>`${Math.floor(e/60).toString().padStart(2,"0")}:${(e%60).toString().padStart(2,"0")}`}};function g({onRecordingComplete:e}){let{isRecording:s,recordingTime:t,audioBlob:a,startRecording:i,stopRecording:l,resetRecording:n,formatTime:c}=p(),o=async()=>{try{await i()}catch(e){console.error("Failed to start recording:",e)}};return(0,r.jsxs)("div",{className:"flex flex-col items-center space-y-6",children:[r.jsx("div",{className:"text-4xl font-mono text-blue-500",children:c(t)}),!s&&!a&&r.jsx("button",{onClick:o,className:"w-20 h-20 bg-red-600 hover:bg-red-700 rounded-full flex items-center justify-center transition-colors cursor-pointer whitespace-nowrap",children:r.jsx("div",{className:"w-8 h-8 flex items-center justify-center",children:r.jsx("i",{className:"ri-mic-line text-3xl text-white"})})}),s&&r.jsx("button",{onClick:()=>{l()},className:"w-20 h-20 bg-gray-600 hover:bg-gray-700 rounded-full flex items-center justify-center transition-colors cursor-pointer whitespace-nowrap",children:r.jsx("div",{className:"w-8 h-8 flex items-center justify-center",children:r.jsx("i",{className:"ri-stop-line text-3xl text-white"})})}),a&&!s&&(0,r.jsxs)("div",{className:"flex space-x-4",children:[r.jsx("button",{onClick:()=>{n()},className:"px-6 py-3 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors cursor-pointer whitespace-nowrap",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:r.jsx("i",{className:"ri-delete-bin-line"})}),r.jsx("span",{children:"Discard"})]})}),r.jsx("button",{onClick:()=>{a&&(e(a,t),n())},className:"px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors cursor-pointer whitespace-nowrap",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:r.jsx("i",{className:"ri-save-line"})}),r.jsx("span",{children:"Process"})]})})]})]})}function y({transcript:e,loading:s,transcriptSegments:t=[],sentimentMap:i=[],keywordAnalysis:l=[],speakers:n=[],overallSentiment:c="neutral"}){let[o,d]=(0,a.useState)("transcript"),[x,m]=(0,a.useState)(t.length>0);if(s)return(0,r.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 border border-gray-700",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-4",children:[r.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-500"}),r.jsx("h3",{className:"text-lg font-semibold text-white",children:"Analyzing conversation..."})]}),r.jsx("p",{className:"text-gray-400",children:"Transcribing audio, identifying speakers, and analyzing sentiment"})]});let u=e=>{switch(e){case"positive":return"text-green-400 bg-green-900/20 border-green-700/50";case"negative":return"text-red-400 bg-red-900/20 border-red-700/50";default:return"text-gray-400 bg-gray-900/20 border-gray-700/50"}},h=e=>{switch(e){case"Agent":return"text-blue-400 bg-blue-900/30";case"Client":return"text-purple-400 bg-purple-900/30";case"Client2":return"text-green-400 bg-green-900/30";default:return"text-gray-400 bg-gray-900/30"}},p=e=>{switch(e){case"property":return"text-blue-400 bg-blue-900/30";case"price":return"text-yellow-400 bg-yellow-900/30";case"concern":case"negative":return"text-red-400 bg-red-900/30";case"positive":return"text-green-400 bg-green-900/30";default:return"text-gray-400 bg-gray-900/30"}},g=(e,s)=>{if(0===s.length)return e;let t=e;return s.slice(0,10).forEach(e=>{let s=RegExp(`\\b${e.word}\\b`,"gi");t=t.replace(s,`<mark class="bg-yellow-900/40 text-yellow-200 px-1 rounded">${e.word}</mark>`)}),t};return(0,r.jsxs)("div",{className:"bg-gray-800 rounded-lg border border-gray-700",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-700",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("div",{className:"w-5 h-5 flex items-center justify-center",children:r.jsx("i",{className:"ri-file-text-line text-blue-500"})}),r.jsx("h3",{className:"text-lg font-semibold text-white",children:"Conversation Analysis"})]}),r.jsx("div",{className:`px-3 py-1 rounded-full border text-xs font-medium ${u(c)}`,children:(0,r.jsxs)("div",{className:"flex items-center space-x-1",children:[r.jsx("div",{className:"w-3 h-3 flex items-center justify-center",children:r.jsx("i",{className:`ri-${"positive"===c?"emotion-happy":"negative"===c?"emotion-sad":"emotion-normal"}-line`})}),(0,r.jsxs)("span",{className:"capitalize",children:[c," Tone"]})]})})]}),(0,r.jsxs)("div",{className:"flex border-b border-gray-700",children:[r.jsx("button",{onClick:()=>d("transcript"),className:`flex-1 px-1 py-1 text-sm font-medium transition-colors cursor-pointer whitespace-nowrap rounded-full ${"transcript"===o?"bg-blue-600 text-white":"text-gray-400 hover:text-white"}`,children:"Transcript"}),r.jsx("button",{onClick:()=>d("analysis"),className:`flex-1 px-1 py-1 text-sm font-medium transition-colors cursor-pointer whitespace-nowrap rounded-full ${"analysis"===o?"bg-blue-600 text-white":"text-gray-400 hover:text-white"}`,children:"Sentiment"}),r.jsx("button",{onClick:()=>d("keywords"),className:`flex-1 px-1 py-1 text-sm font-medium transition-colors cursor-pointer whitespace-nowrap rounded-full ${"keywords"===o?"bg-blue-600 text-white":"text-gray-400 hover:text-white"}`,children:"Keywords"})]}),(0,r.jsxs)("div",{className:"p-4",children:["transcript"===o&&(0,r.jsxs)("div",{className:"space-y-4",children:[t.length>0&&(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("span",{className:"text-sm text-gray-400",children:"Show speakers:"}),r.jsx("button",{onClick:()=>m(!x),className:`px-3 py-1 rounded-lg text-xs transition-colors cursor-pointer whitespace-nowrap ${x?"bg-blue-600 text-white":"bg-gray-700 text-gray-300"}`,children:x?"On":"Off"})]}),x&&n.length>1&&r.jsx("div",{className:"flex items-center space-x-2",children:n.map((e,s)=>r.jsx("div",{className:`px-2 py-1 rounded-full text-xs ${h(e)}`,children:e},s))})]}),r.jsx("div",{className:"bg-gray-900 rounded-lg p-4 max-h-80 overflow-y-auto",children:x&&t.length>0?r.jsx("div",{className:"space-y-3",children:t.map((e,s)=>(0,r.jsxs)("div",{className:"flex space-x-3",children:[r.jsx("div",{className:`px-2 py-1 rounded text-xs font-medium flex-shrink-0 ${h(e.speaker)}`,children:e.speaker}),(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("p",{className:"text-gray-300 text-sm leading-relaxed",dangerouslySetInnerHTML:{__html:g(e.text,l)}}),r.jsx("div",{className:`inline-block mt-1 px-2 py-0.5 rounded-full text-xs ${u(e.sentiment)}`,children:e.sentiment})]})]},s))}):r.jsx("p",{className:"text-gray-300 leading-relaxed",dangerouslySetInnerHTML:{__html:g(e,l)}})})]}),"analysis"===o&&(0,r.jsxs)("div",{className:"space-y-4",children:[r.jsx("div",{className:"grid grid-cols-3 gap-4",children:["positive","neutral","negative"].map(e=>{let s=i.filter(s=>s.sentiment===e).length,t=i.length>0?Math.round(s/i.length*100):0;return r.jsx("div",{className:`p-3 rounded-lg border ${u(e)}`,children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsxs)("div",{className:"text-lg font-bold",children:[t,"%"]}),r.jsx("div",{className:"text-xs capitalize",children:e}),(0,r.jsxs)("div",{className:"text-xs opacity-75",children:["(",s," segments)"]})]})},e)})}),i.length>0&&(0,r.jsxs)("div",{className:"bg-gray-900 rounded-lg p-4 max-h-64 overflow-y-auto",children:[r.jsx("h4",{className:"text-sm font-medium text-gray-300 mb-3",children:"Sentence-level Analysis"}),r.jsx("div",{className:"space-y-2",children:i.slice(0,10).map((e,s)=>(0,r.jsxs)("div",{className:"flex items-start space-x-3",children:[r.jsx("div",{className:`px-2 py-1 rounded text-xs ${u(e.sentiment)}`,children:e.sentiment}),(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("p",{className:"text-gray-300 text-sm",children:e.sentence}),(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:["Confidence: ",Math.round(100*e.confidence),"%"]})]})]},s))})]})]}),"keywords"===o&&r.jsx("div",{className:"space-y-4",children:l.length>0?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-gray-300 mb-3",children:"Top Discussion Topics"}),r.jsx("div",{className:"flex flex-wrap gap-2",children:((e,s=8)=>e.sort((e,s)=>s.relevance*s.frequency-e.relevance*e.frequency).slice(0,s))(l).map((e,s)=>(0,r.jsxs)("div",{className:`px-3 py-2 rounded-lg border ${p(e.category)}`,children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("span",{className:"font-medium",children:e.word}),(0,r.jsxs)("span",{className:"text-xs opacity-75",children:["\xd7",e.frequency]})]}),r.jsx("div",{className:"text-xs opacity-75 capitalize",children:e.category||"general"})]},s))})]}),(0,r.jsxs)("div",{className:"bg-gray-900 rounded-lg p-4 max-h-64 overflow-y-auto",children:[r.jsx("h4",{className:"text-sm font-medium text-gray-300 mb-3",children:"Detailed Keyword Analysis"}),r.jsx("div",{className:"space-y-3",children:l.slice(0,15).map((e,s)=>(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[r.jsx("span",{className:"text-white font-medium",children:e.word}),r.jsx("span",{className:`px-2 py-1 rounded text-xs ${p(e.category)}`,children:e.category||"general"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-3 text-sm text-gray-400",children:[(0,r.jsxs)("span",{children:["\xd7",e.frequency]}),r.jsx("div",{className:"w-16 bg-gray-700 rounded-full h-2",children:r.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:`${100*e.relevance}%`}})})]})]},s))})]})]}):(0,r.jsxs)("div",{className:"text-center py-8",children:[r.jsx("div",{className:"w-16 h-16 mx-auto mb-4 flex items-center justify-center",children:r.jsx("i",{className:"ri-search-line text-4xl text-gray-600"})}),r.jsx("h4",{className:"text-lg font-medium text-gray-400 mb-2",children:"No Keywords Identified"}),r.jsx("p",{className:"text-gray-500",children:"Keyword analysis will appear here after processing"})]})})]})]})}var j=t(5502);function f({isOpen:e,onClose:s,recordingId:t,userId:i,clientName:l,clientEmail:n,clientPhone:c,onScheduled:o}){let[d,x]=(0,a.useState)("both"),[m,u]=(0,a.useState)(""),[h,p]=(0,a.useState)(""),[g,y]=(0,a.useState)(!1),[f,b]=(0,a.useState)(null),N=async()=>{if(!m||!h){b("Please select both date and time");return}if(("email"===d||"both"===d)&&!n){b("Email address is required for email delivery");return}if(("sms"===d||"both"===d)&&!c){b("Phone number is required for SMS delivery");return}y(!0),b(null);try{let e=new Date(`${m}T${h}`);if(e<=new Date){b("Scheduled time must be in the future"),y(!1);return}await (0,j.uI)(t,d,e,i)?(o(),s()):b("Failed to schedule follow-up. Please try again.")}catch(e){console.error("Error scheduling follow-up:",e),b("Failed to schedule follow-up. Please try again.")}finally{y(!1)}};return e?r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:(0,r.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-md border border-gray-700",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h2",{className:"text-lg font-semibold text-white",children:"Schedule Follow-up"}),r.jsx("button",{onClick:s,className:"text-gray-400 hover:text-white transition-colors cursor-pointer",children:r.jsx("div",{className:"w-5 h-5 flex items-center justify-center",children:r.jsx("i",{className:"ri-close-line text-xl"})})})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"bg-gray-900 rounded-lg p-3",children:[r.jsx("h3",{className:"font-medium text-white mb-2",children:l}),(0,r.jsxs)("div",{className:"space-y-1 text-sm text-gray-400",children:[n&&(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("div",{className:"w-3 h-3 flex items-center justify-center",children:r.jsx("i",{className:"ri-mail-line"})}),r.jsx("span",{children:n})]}),c&&(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("div",{className:"w-3 h-3 flex items-center justify-center",children:r.jsx("i",{className:"ri-phone-line"})}),r.jsx("span",{children:c})]})]})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Delivery Method"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("label",{className:"flex items-center space-x-2",children:[r.jsx("input",{type:"radio",value:"email",checked:"email"===d,onChange:e=>x(e.target.value),disabled:!n,className:"w-4 h-4 text-blue-600 bg-gray-800 border-gray-600 focus:ring-blue-500"}),(0,r.jsxs)("span",{className:`text-sm ${n?"text-gray-300":"text-gray-500"}`,children:["Email only ",!n&&"(no email provided)"]})]}),(0,r.jsxs)("label",{className:"flex items-center space-x-2",children:[r.jsx("input",{type:"radio",value:"sms",checked:"sms"===d,onChange:e=>x(e.target.value),disabled:!c,className:"w-4 h-4 text-blue-600 bg-gray-800 border-gray-600 focus:ring-blue-500"}),(0,r.jsxs)("span",{className:`text-sm ${c?"text-gray-300":"text-gray-500"}`,children:["SMS only ",!c&&"(no phone provided)"]})]}),(0,r.jsxs)("label",{className:"flex items-center space-x-2",children:[r.jsx("input",{type:"radio",value:"both",checked:"both"===d,onChange:e=>x(e.target.value),disabled:!n||!c,className:"w-4 h-4 text-blue-600 bg-gray-800 border-gray-600 focus:ring-blue-500"}),(0,r.jsxs)("span",{className:`text-sm ${n&&c?"text-gray-300":"text-gray-500"}`,children:["Both Email & SMS ",(!n||!c)&&"(requires both)"]})]})]})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Send Date"}),r.jsx("input",{type:"date",value:m,onChange:e=>u(e.target.value),min:new Date().toISOString().split("T")[0],className:"w-full px-3 py-2 border border-gray-700 rounded-lg bg-gray-800 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Send Time"}),r.jsx("input",{type:"time",value:h,onChange:e=>p(e.target.value),className:"w-full px-3 py-2 border border-gray-700 rounded-lg bg-gray-800 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Quick Schedule"}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[r.jsx("button",{onClick:()=>{let e=new Date;e.setMinutes(e.getMinutes()+30),u(e.toISOString().split("T")[0]),p(e.toTimeString().slice(0,5))},className:"px-3 py-1 bg-gray-700 hover:bg-gray-600 text-white rounded text-xs transition-colors cursor-pointer whitespace-nowrap",children:"+30 min"}),r.jsx("button",{onClick:()=>{let e=new Date;e.setHours(e.getHours()+1),u(e.toISOString().split("T")[0]),p(e.toTimeString().slice(0,5))},className:"px-3 py-1 bg-gray-700 hover:bg-gray-600 text-white rounded text-xs transition-colors cursor-pointer whitespace-nowrap",children:"+1 hour"}),r.jsx("button",{onClick:()=>{let e=new Date;e.setDate(e.getDate()+1),e.setHours(9,0,0,0),u(e.toISOString().split("T")[0]),p("09:00")},className:"px-3 py-1 bg-gray-700 hover:bg-gray-600 text-white rounded text-xs transition-colors cursor-pointer whitespace-nowrap",children:"Tomorrow 9AM"})]})]}),f&&r.jsx("div",{className:"p-3 bg-red-900/30 border border-red-700 rounded-lg",children:r.jsx("p",{className:"text-red-300 text-sm",children:f})}),(0,r.jsxs)("div",{className:"flex items-center space-x-3 pt-4",children:[r.jsx("button",{onClick:s,className:"flex-1 px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors cursor-pointer whitespace-nowrap",children:"Cancel"}),r.jsx("button",{onClick:N,disabled:g||!m||!h,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-800 disabled:opacity-50 text-white rounded-lg transition-colors cursor-pointer whitespace-nowrap flex items-center justify-center space-x-2",children:g?(0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),r.jsx("span",{children:"Scheduling..."})]}):(0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:r.jsx("i",{className:"ri-calendar-check-line"})}),r.jsx("span",{children:"Schedule"})]})})]})]})]})}):null}function b({audioUrl:e,label:s="Play Audio",variant:t="default",onPlay:i,onPause:l,onEnded:n}){let[c,o]=(0,a.useState)(!1),[d,x]=(0,a.useState)(0),[m,u]=(0,a.useState)(0),[h,p]=(0,a.useState)(!1),[g,y]=(0,a.useState)(null),j=(0,a.useRef)(null),f=(0,a.useRef)(null),b=async()=>{let e=j.current;if(e&&!h)try{c?(e.pause(),o(!1),l?.()):(await e.play(),o(!0),i?.())}catch(e){console.error("Error playing audio:",e),y("Playback failed"),o(!1)}},N=e=>{let s=j.current,t=f.current;if(!s||!t||!d)return;let r=t.getBoundingClientRect(),a=(e.clientX-r.left)/r.width*d;s.currentTime=a,u(a)},v=e=>`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`,w=d>0?m/d*100:0;return"compact"===t?(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("audio",{ref:j,src:e,preload:"metadata"}),(0,r.jsxs)("button",{onClick:b,disabled:h||!!g,className:"flex items-center space-x-1 px-2 py-1 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-600 text-white rounded text-xs transition-colors cursor-pointer whitespace-nowrap",children:[h?r.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border border-white border-t-transparent"}):g?r.jsx("div",{className:"w-3 h-3 flex items-center justify-center",children:r.jsx("i",{className:"ri-error-warning-line"})}):r.jsx("div",{className:"w-3 h-3 flex items-center justify-center",children:r.jsx("i",{className:`ri-${c?"pause":"play"}-fill`})}),r.jsx("span",{children:s})]}),g&&r.jsx("span",{className:"text-red-400 text-xs",children:g})]}):"inline"===t?(0,r.jsxs)("div",{className:"flex items-center space-x-3 bg-gray-900 rounded-lg p-2",children:[r.jsx("audio",{ref:j,src:e,preload:"metadata"}),r.jsx("button",{onClick:b,disabled:h||!!g,className:"w-8 h-8 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-600 rounded-full flex items-center justify-center transition-colors cursor-pointer whitespace-nowrap",children:h?r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border border-white border-t-transparent"}):g?r.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:r.jsx("i",{className:"ri-error-warning-line text-white"})}):r.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:r.jsx("i",{className:`ri-${c?"pause":"play"}-fill text-white`})})}),(0,r.jsxs)("div",{className:"flex-1 flex items-center space-x-2",children:[r.jsx("div",{ref:f,onClick:N,className:"flex-1 h-2 bg-gray-700 rounded-full cursor-pointer relative",children:r.jsx("div",{className:"h-full bg-purple-500 rounded-full transition-all duration-100",style:{width:`${w}%`}})}),(0,r.jsxs)("div",{className:"text-xs text-gray-400 min-w-[60px] text-right",children:[v(m)," / ",v(d)]})]}),g&&r.jsx("span",{className:"text-red-400 text-xs",children:g})]}):(0,r.jsxs)("div",{className:"bg-gray-900 rounded-lg p-4 border border-gray-700",children:[r.jsx("audio",{ref:j,src:e,preload:"metadata"}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[r.jsx("button",{onClick:b,disabled:h||!!g,className:"w-12 h-12 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-600 rounded-full flex items-center justify-center transition-colors cursor-pointer whitespace-nowrap",children:h?r.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-2 border-white border-t-transparent"}):g?r.jsx("div",{className:"w-6 h-6 flex items-center justify-center",children:r.jsx("i",{className:"ri-error-warning-line text-white text-xl"})}):r.jsx("div",{className:"w-6 h-6 flex items-center justify-center",children:r.jsx("i",{className:`ri-${c?"pause":"play"}-fill text-white text-xl`})})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("span",{className:"text-white font-medium text-sm",children:s}),(0,r.jsxs)("span",{className:"text-gray-400 text-xs",children:[v(m)," / ",v(d)]})]}),r.jsx("div",{ref:f,onClick:N,className:"w-full h-2 bg-gray-700 rounded-full cursor-pointer relative",children:r.jsx("div",{className:"h-full bg-purple-500 rounded-full transition-all duration-100",style:{width:`${w}%`}})})]})]}),g&&r.jsx("div",{className:"mt-3 text-red-400 text-sm",children:g})]})}let N={friendly:{label:"Friendly",description:"Warm, conversational, and approachable tone",icon:"ri-emotion-happy-line",color:"bg-green-600"},professional:{label:"Professional",description:"Business-focused, formal, and comprehensive tone",icon:"ri-briefcase-line",color:"bg-blue-600"},direct:{label:"Direct",description:"Straight-forward, concise, and action-focused tone",icon:"ri-arrow-right-line",color:"bg-purple-600"},"action-oriented":{label:"Action-Oriented",description:"Urgency-driven with clear calls-to-action",icon:"ri-alarm-line",color:"bg-red-600"}};function v({data:e,loading:s,clientEmail:t,clientPhone:l,recordingId:n,onToneChange:c,scheduledFollowUp:d,userId:x,clientName:m,voiceSummaryUrl:u}){let h={preferences:e.preferences||"No preferences found.",objections:e.objections||"No objections found.",sms:e.sms||"No SMS content available",email:e.email||"No email content available",urgencyLevel:e.urgencyLevel||"medium",keyTopics:e.keyTopics||["No topics found."],recommendedActions:e.recommendedActions||["No recommended actions."],tone:e.tone||"professional"};console.log("\uD83E\uDDE0 Final AI Follow-up data:",h),console.log("\uD83D\uDD0D Raw data received:",e);let[p,g]=(0,a.useState)("summary"),[y,j]=(0,a.useState)(null),[v,w]=(0,a.useState)(h.tone),[S,C]=(0,a.useState)({}),[k,A]=(0,a.useState)({preferences:h.preferences,objections:h.objections,sms:h.sms,email:h.email}),[D,T]=(0,a.useState)(!1),[R,P]=(0,a.useState)(!1),[E,I]=(0,a.useState)(!1),$=async(e,s)=>{try{await navigator.clipboard.writeText(e),j(s),setTimeout(()=>j(null),2e3)}catch(e){console.error("Failed to copy:",e)}},F=e=>{w(e),c&&c(e)},q=e=>{C({...S,[e]:!0})},O=async e=>{if(!n){C({...S,[e]:!1}),P(!0);return}T(!0);try{let s=(0,i.JU)(o.db,"recordings",n),t={editedByAgent:!0,updatedAt:(0,i.Bt)()};t[`aiFollowUpFinal.${e}`]=k[e],t["aiFollowUpFinal.tone"]=v,await (0,i.r7)(s,t),C({...S,[e]:!1}),P(!0),console.log(`✅ Updated ${e} in Firestore`)}catch(s){console.error(`❌ Failed to update ${e}:`,s),alert("Failed to save changes. Please try again.")}finally{T(!1)}},U=e=>{A({...k,[e]:"preferences"===e?h.preferences:"objections"===e?h.objections:"sms"===e?h.sms:h.email}),C({...S,[e]:!1})};return s?(0,r.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 border border-gray-700",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[r.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-500"}),r.jsx("h3",{className:"text-lg font-semibold text-white",children:"Generating AI Follow-up..."})]}),r.jsx("p",{className:"text-gray-400",children:"Analyzing conversation and creating personalized follow-up content"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"bg-gray-800 rounded-lg border border-gray-700",children:[(0,r.jsxs)("div",{className:"p-4 border-b border-gray-700",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("div",{className:"w-5 h-5 flex items-center justify-center",children:r.jsx("i",{className:"ri-robot-line text-blue-500"})}),r.jsx("h3",{className:"text-lg font-semibold text-white",children:"AI Follow-up"}),R&&r.jsx("span",{className:"px-2 py-1 bg-orange-900/30 text-orange-300 rounded-full text-xs",children:"Edited"}),d?(0,r.jsxs)("div",{className:`px-2 py-1 rounded-full text-xs font-medium ${{pending:"text-yellow-400 bg-yellow-900/30",sent:"text-green-400 bg-green-900/30",failed:"text-red-400 bg-red-900/30",cancelled:"text-gray-400 bg-gray-900/30"}[d.status]}`,children:["pending"===d.status&&"⏰ Scheduled","sent"===d.status&&"✅ Delivered","failed"===d.status&&"❌ Failed","cancelled"===d.status&&"\uD83D\uDEAB Cancelled"]}):null]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[u&&r.jsx(b,{audioUrl:u,label:"\uD83D\uDD0A Voice Summary",variant:"compact"}),n&&x&&!d&&(0,r.jsxs)("button",{onClick:()=>I(!0),className:"flex items-center space-x-1 px-3 py-1 bg-green-600 hover:bg-green-700 text-white rounded text-xs transition-colors cursor-pointer whitespace-nowrap",children:[r.jsx("div",{className:"w-3 h-3 flex items-center justify-center",children:r.jsx("i",{className:"ri-calendar-schedule-line"})}),r.jsx("span",{children:"Schedule"})]})]})]}),r.jsx("div",{className:"flex items-center justify-between mb-3",children:(0,r.jsxs)("div",{className:`px-3 py-1 rounded-full text-xs font-medium ${(e=>{switch(e){case"high":return"text-red-400 bg-red-900/30";case"medium":return"text-yellow-400 bg-yellow-900/30";case"low":return"text-green-400 bg-green-900/30";default:return"text-gray-400 bg-gray-900/30"}})(h.urgencyLevel)}`,children:[h.urgencyLevel.toUpperCase()," Priority"]})}),(0,r.jsxs)("div",{children:[r.jsx("div",{className:"flex items-center space-x-2 mb-2",children:r.jsx("span",{className:"text-sm text-gray-400",children:"Follow-up Tone:"})}),r.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(N).map(([e,s])=>(0,r.jsxs)("button",{onClick:()=>F(e),className:`p-3 rounded-lg border text-left transition-colors cursor-pointer ${v===e?`${s.color} text-white border-transparent`:"bg-gray-900 text-gray-300 border-gray-700 hover:border-gray-600"}`,children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[r.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:r.jsx("i",{className:s.icon})}),r.jsx("span",{className:"font-medium text-sm",children:s.label})]}),r.jsx("p",{className:"text-xs opacity-75",children:s.description})]},e))})]}),d&&r.jsx("div",{className:"mt-3 p-3 bg-blue-900/20 border border-blue-700/50 rounded-lg",children:r.jsx("div",{className:"flex items-center justify-between",children:(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{className:"text-blue-300 text-sm font-medium",children:["\uD83D\uDCC5 Scheduled for ",d.method," delivery"]}),r.jsx("p",{className:"text-blue-200 text-xs",children:new Date(d.sendAt.toDate()).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})})})]}),(0,r.jsxs)("div",{className:"flex border-b border-gray-700",children:[r.jsx("button",{onClick:()=>g("summary"),className:`flex-1 px-1 py-1 text-sm font-medium transition-colors cursor-pointer whitespace-nowrap rounded-full ${"summary"===p?"bg-blue-600 text-white":"text-gray-400 hover:text-white"}`,children:"Summary"}),r.jsx("button",{onClick:()=>g("sms"),className:`flex-1 px-1 py-1 text-sm font-medium transition-colors cursor-pointer whitespace-nowrap rounded-full ${"sms"===p?"bg-blue-600 text-white":"text-gray-400 hover:text-white"}`,children:"SMS"}),r.jsx("button",{onClick:()=>g("email"),className:`flex-1 px-1 py-1 text-sm font-medium transition-colors cursor-pointer whitespace-nowrap rounded-full ${"email"===p?"bg-blue-600 text-white":"text-gray-400 hover:text-white"}`,children:"Email"}),r.jsx("button",{onClick:()=>g("actions"),className:`flex-1 px-1 py-1 text-sm font-medium transition-colors cursor-pointer whitespace-nowrap rounded-full ${"actions"===p?"bg-blue-600 text-white":"text-gray-400 hover:text-white"}`,children:"Actions"})]}),(0,r.jsxs)("div",{className:"p-4",children:["summary"===p&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("h4",{className:"font-medium text-green-400",children:"Client Preferences"}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[!S.preferences&&r.jsx("button",{onClick:()=>q("preferences"),className:"text-gray-400 hover:text-white transition-colors cursor-pointer",children:r.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:r.jsx("i",{className:"ri-edit-line"})})}),r.jsx("button",{onClick:()=>$(k.preferences,"preferences"),className:"text-gray-400 hover:text-white transition-colors cursor-pointer",children:r.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:r.jsx("i",{className:`ri-${"preferences"===y?"check":"file-copy"}-line`})})})]})]}),S.preferences?(0,r.jsxs)("div",{className:"space-y-2",children:[r.jsx("textarea",{value:k.preferences,onChange:e=>A({...k,preferences:e.target.value}),className:"w-full px-3 py-2 bg-gray-900 border border-gray-700 rounded-lg text-gray-300 text-sm resize-none focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("button",{onClick:()=>O("preferences"),disabled:D,className:"px-3 py-1 bg-green-600 hover:bg-green-700 disabled:bg-green-800 text-white rounded text-xs transition-colors cursor-pointer whitespace-nowrap",children:D?"Saving...":"Save"}),r.jsx("button",{onClick:()=>U("preferences"),className:"px-3 py-1 bg-gray-600 hover:bg-gray-700 text-white rounded text-xs transition-colors cursor-pointer whitespace-nowrap",children:"Cancel"})]})]}):r.jsx("p",{className:"text-gray-300 text-sm leading-relaxed",children:k.preferences})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("h4",{className:"font-medium text-red-400",children:"Client Concerns"}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[!S.objections&&r.jsx("button",{onClick:()=>q("objections"),className:"text-gray-400 hover:text-white transition-colors cursor-pointer",children:r.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:r.jsx("i",{className:"ri-edit-line"})})}),r.jsx("button",{onClick:()=>$(k.objections,"objections"),className:"text-gray-400 hover:text-white transition-colors cursor-pointer",children:r.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:r.jsx("i",{className:`ri-${"objections"===y?"check":"file-copy"}-line`})})})]})]}),S.objections?(0,r.jsxs)("div",{className:"space-y-2",children:[r.jsx("textarea",{value:k.objections,onChange:e=>A({...k,objections:e.target.value}),className:"w-full px-3 py-2 bg-gray-900 border border-gray-700 rounded-lg text-gray-300 text-sm resize-none focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("button",{onClick:()=>O("objections"),disabled:D,className:"px-3 py-1 bg-green-600 hover:bg-green-700 disabled:bg-green-800 text-white rounded text-xs transition-colors cursor-pointer whitespace-nowrap",children:D?"Saving...":"Save"}),r.jsx("button",{onClick:()=>U("objections"),className:"px-3 py-1 bg-gray-600 hover:bg-gray-700 text-white rounded text-xs transition-colors cursor-pointer whitespace-nowrap",children:"Cancel"})]})]}):r.jsx("p",{className:"text-gray-300 text-sm leading-relaxed",children:k.objections})]})]}),"sms"===p&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:r.jsx("i",{className:"ri-message-3-line text-blue-500"})}),r.jsx("span",{className:"font-medium text-white",children:"SMS Message"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[!S.sms&&r.jsx("button",{onClick:()=>q("sms"),className:"text-gray-400 hover:text-white transition-colors cursor-pointer",children:r.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:r.jsx("i",{className:"ri-edit-line"})})}),r.jsx("button",{onClick:()=>$(k.sms,"sms"),className:"text-gray-400 hover:text-white transition-colors cursor-pointer",children:r.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:r.jsx("i",{className:`ri-${"sms"===y?"check":"file-copy"}-line`})})})]})]}),l&&(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-3 text-sm text-gray-400",children:[r.jsx("div",{className:"w-3 h-3 flex items-center justify-center",children:r.jsx("i",{className:"ri-phone-line"})}),(0,r.jsxs)("span",{children:["To: ",l]})]}),S.sms?(0,r.jsxs)("div",{className:"space-y-2",children:[r.jsx("textarea",{value:k.sms,onChange:e=>A({...k,sms:e.target.value}),className:"w-full px-3 py-2 bg-gray-900 border border-gray-700 rounded-lg text-gray-300 text-sm resize-none focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,maxLength:160}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("span",{className:"text-xs text-gray-500",children:[k.sms.length,"/160 characters"]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("button",{onClick:()=>O("sms"),disabled:D,className:"px-3 py-1 bg-green-600 hover:bg-green-700 disabled:bg-green-800 text-white rounded text-xs transition-colors cursor-pointer whitespace-nowrap",children:D?"Saving...":"Save"}),r.jsx("button",{onClick:()=>U("sms"),className:"px-3 py-1 bg-gray-600 hover:bg-gray-700 text-white rounded text-xs transition-colors cursor-pointer whitespace-nowrap",children:"Cancel"})]})]})]}):(0,r.jsxs)("div",{className:"bg-gray-900 rounded-lg p-3",children:[r.jsx("p",{className:"text-gray-300 text-sm leading-relaxed",children:k.sms}),(0,r.jsxs)("div",{className:"text-xs text-gray-500 mt-2",children:[k.sms.length,"/160 characters"]})]})]}),"email"===p&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:r.jsx("i",{className:"ri-mail-line text-blue-500"})}),r.jsx("span",{className:"font-medium text-white",children:"Email Message"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[!S.email&&r.jsx("button",{onClick:()=>q("email"),className:"text-gray-400 hover:text-white transition-colors cursor-pointer",children:r.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:r.jsx("i",{className:"ri-edit-line"})})}),r.jsx("button",{onClick:()=>$(k.email,"email"),className:"text-gray-400 hover:text-white transition-colors cursor-pointer",children:r.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:r.jsx("i",{className:`ri-${"email"===y?"check":"file-copy"}-line`})})})]})]}),t&&(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-3 text-sm text-gray-400",children:[r.jsx("div",{className:"w-3 h-3 flex items-center justify-center",children:r.jsx("i",{className:"ri-mail-line"})}),(0,r.jsxs)("span",{children:["To: ",t]})]}),S.email?(0,r.jsxs)("div",{className:"space-y-2",children:[r.jsx("textarea",{value:k.email,onChange:e=>A({...k,email:e.target.value}),className:"w-full px-3 py-2 bg-gray-900 border border-gray-700 rounded-lg text-gray-300 text-sm resize-none focus:outline-none focus:ring-2 focus:ring-blue-500",rows:8}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("button",{onClick:()=>O("email"),disabled:D,className:"px-3 py-1 bg-green-600 hover:bg-green-700 disabled:bg-green-800 text-white rounded text-xs transition-colors cursor-pointer whitespace-nowrap",children:D?"Saving...":"Save"}),r.jsx("button",{onClick:()=>U("email"),className:"px-3 py-1 bg-gray-600 hover:bg-gray-700 text-white rounded text-xs transition-colors cursor-pointer whitespace-nowrap",children:"Cancel"})]})]}):r.jsx("div",{className:"bg-gray-900 rounded-lg p-3 max-h-64 overflow-y-auto",children:r.jsx("p",{className:"text-gray-300 text-sm leading-relaxed whitespace-pre-line",children:k.email})})]}),"actions"===p&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[r.jsx("h4",{className:"font-medium text-blue-400 mb-2",children:"Discussion Topics"}),r.jsx("div",{className:"flex flex-wrap gap-2",children:h.keyTopics.map((e,s)=>r.jsx("span",{className:"px-3 py-1 bg-blue-900/30 text-blue-300 rounded-full text-sm",children:e},s))})]}),(0,r.jsxs)("div",{children:[r.jsx("h4",{className:"font-medium text-green-400 mb-2",children:"Recommended Next Steps"}),r.jsx("div",{className:"space-y-2",children:h.recommendedActions.map((e,s)=>(0,r.jsxs)("div",{className:"flex items-start space-x-3 p-3 bg-gray-900 rounded-lg",children:[r.jsx("div",{className:"w-5 h-5 flex items-center justify-center mt-0.5",children:r.jsx("i",{className:"ri-checkbox-circle-line text-green-500"})}),r.jsx("span",{className:"text-gray-300 text-sm",children:e})]},s))})]})]})]})]}),E&&n&&x&&m&&r.jsx(f,{isOpen:E,onClose:()=>I(!1),recordingId:n,userId:x,clientName:m,clientEmail:t,clientPhone:l,onScheduled:()=>{I(!1),window.location.reload()}})]})}let w=e=>({Investor:"ri-money-dollar-circle-line","First-Time Buyer":"ri-home-heart-line",Upsizer:"ri-arrow-up-circle-line",Downsizer:"ri-arrow-down-circle-line",Relocator:"ri-map-pin-line","Second Home":"ri-home-2-line",Other:"ri-user-line"})[e]||"ri-user-line",S=e=>({Investor:"text-green-400 bg-green-900/30","First-Time Buyer":"text-blue-400 bg-blue-900/30",Upsizer:"text-purple-400 bg-purple-900/30",Downsizer:"text-orange-400 bg-orange-900/30",Relocator:"text-yellow-400 bg-yellow-900/30","Second Home":"text-pink-400 bg-pink-900/30",Other:"text-gray-400 bg-gray-900/30"})[e]||"text-gray-400 bg-gray-900/30",C=e=>({Immediate:"text-red-400 bg-red-900/30","Within 30 Days":"text-orange-400 bg-orange-900/30","2-3 Months":"text-yellow-400 bg-yellow-900/30","6+ Months":"text-blue-400 bg-blue-900/30",Exploring:"text-gray-400 bg-gray-900/30"})[e]||"text-gray-400 bg-gray-900/30",k=e=>({Analytical:"ri-bar-chart-line",Enthusiastic:"ri-emotion-happy-line",Cautious:"ri-shield-check-line",Decisive:"ri-flashlight-line",Social:"ri-team-line"})[e]||"ri-user-line",A=e=>({Email:"ri-mail-line",Phone:"ri-phone-line",Text:"ri-message-3-line","In-Person":"ri-user-voice-line",Mixed:"ri-chat-1-line"})[e]||"ri-chat-1-line",D=e=>e>=.8?"text-green-400 bg-green-900/30":e>=.6?"text-yellow-400 bg-yellow-900/30":"text-red-400 bg-red-900/30";function T({persona:e,loading:s,clientName:t,voiceSummaryUrl:i}){let[l,n]=(0,a.useState)("overview");return s?(0,r.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 border border-gray-700",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[r.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-purple-500"}),r.jsx("h3",{className:"text-lg font-semibold text-white",children:"Generating Buyer Persona..."})]}),r.jsx("p",{className:"text-gray-400",children:"Analyzing conversation to create detailed buyer profile"})]}):e?(0,r.jsxs)("div",{className:"bg-gray-800 rounded-lg border border-gray-700",children:[(0,r.jsxs)("div",{className:"p-4 border-b border-gray-700",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("div",{className:"w-5 h-5 flex items-center justify-center",children:r.jsx("i",{className:"ri-user-star-line text-purple-500"})}),r.jsx("h3",{className:"text-lg font-semibold text-white",children:"Buyer Persona"}),"openai"===e.generatedBy&&r.jsx("span",{className:"px-2 py-1 bg-purple-900/30 text-purple-300 rounded-full text-xs",children:"AI Generated"})]}),i&&r.jsx(b,{audioUrl:i,label:"\uD83D\uDD0A Voice Summary",variant:"compact"})]}),(0,r.jsxs)("div",{className:`inline-flex items-center space-x-2 px-3 py-2 rounded-lg ${S(e.buyerType)}`,children:[r.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:r.jsx("i",{className:w(e.buyerType)})}),r.jsx("span",{className:"font-medium",children:e.buyerType})]})]}),(0,r.jsxs)("div",{className:"flex border-b border-gray-700",children:[r.jsx("button",{onClick:()=>n("overview"),className:`flex-1 px-1 py-1 text-sm font-medium transition-colors cursor-pointer whitespace-nowrap rounded-full ${"overview"===l?"bg-purple-600 text-white":"text-gray-400 hover:text-white"}`,children:"Overview"}),r.jsx("button",{onClick:()=>n("motivations"),className:`flex-1 px-1 py-1 text-sm font-medium transition-colors cursor-pointer whitespace-nowrap rounded-full ${"motivations"===l?"bg-purple-600 text-white":"text-gray-400 hover:text-white"}`,children:"Motivations"}),r.jsx("button",{onClick:()=>n("strategy"),className:`flex-1 px-1 py-1 text-sm font-medium transition-colors cursor-pointer whitespace-nowrap rounded-full ${"strategy"===l?"bg-purple-600 text-white":"text-gray-400 hover:text-white"}`,children:"Strategy"})]}),(0,r.jsxs)("div",{className:"p-4",children:["overview"===l&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-gray-400 mb-2",children:"Decision Timeline"}),(0,r.jsxs)("div",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${C(e.decisionTimeline)}`,children:[r.jsx("div",{className:"w-3 h-3 flex items-center justify-center mr-1",children:r.jsx("i",{className:"ri-time-line"})}),e.decisionTimeline]})]}),(0,r.jsxs)("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-gray-400 mb-2",children:"Confidence Score"}),(0,r.jsxs)("div",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${D(e.confidenceScore)}`,children:[r.jsx("div",{className:"w-3 h-3 flex items-center justify-center mr-1",children:r.jsx("i",{className:"ri-thumbs-up-line"})}),Math.round(100*e.confidenceScore),"%"]})]})]}),e.budgetRange&&(0,r.jsxs)("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-gray-400 mb-2",children:"Budget Range"}),r.jsx("div",{className:"bg-gray-900 rounded-lg p-3",children:(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsxs)("span",{className:"text-white font-medium",children:["$",e.budgetRange.min.toLocaleString()," - $",e.budgetRange.max.toLocaleString()]}),r.jsx("span",{className:"text-xs text-gray-400",children:e.budgetRange.flexibility})]})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-gray-400 mb-2",children:"Communication"}),(0,r.jsxs)("div",{className:"flex items-center space-x-2 text-blue-300",children:[r.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:r.jsx("i",{className:A(e.communicationPreference)})}),r.jsx("span",{className:"text-sm",children:e.communicationPreference})]})]}),(0,r.jsxs)("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-gray-400 mb-2",children:"Profile"}),(0,r.jsxs)("div",{className:"flex items-center space-x-2 text-green-300",children:[r.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:r.jsx("i",{className:k(e.emotionalProfile)})}),r.jsx("span",{className:"text-sm",children:e.emotionalProfile})]})]})]}),e.locationPreferences.length>0&&(0,r.jsxs)("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-gray-400 mb-2",children:"Location Preferences"}),r.jsx("div",{className:"flex flex-wrap gap-1",children:e.locationPreferences.map((e,s)=>r.jsx("span",{className:"px-2 py-1 bg-blue-900/30 text-blue-300 rounded-full text-xs",children:e},s))})]}),e.propertyFeaturePriorities.length>0&&(0,r.jsxs)("div",{children:[r.jsx("h4",{className:"text-sm font-medium text-gray-400 mb-2",children:"Feature Priorities"}),r.jsx("div",{className:"flex flex-wrap gap-1",children:e.propertyFeaturePriorities.map((e,s)=>r.jsx("span",{className:"px-2 py-1 bg-purple-900/30 text-purple-300 rounded-full text-xs",children:e},s))})]})]}),"motivations"===l&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[r.jsx("h4",{className:"font-medium text-green-400 mb-3",children:"Key Motivations"}),r.jsx("div",{className:"space-y-2",children:e.keyMotivations.map((e,s)=>(0,r.jsxs)("div",{className:"flex items-start space-x-3 p-2 bg-gray-900 rounded-lg",children:[r.jsx("div",{className:"w-4 h-4 flex items-center justify-center mt-0.5",children:r.jsx("i",{className:"ri-heart-line text-green-500"})}),r.jsx("span",{className:"text-gray-300 text-sm",children:e})]},s))})]}),e.positiveSignals.length>0&&(0,r.jsxs)("div",{children:[r.jsx("h4",{className:"font-medium text-green-400 mb-3",children:"Positive Signals"}),r.jsx("div",{className:"space-y-2",children:e.positiveSignals.map((e,s)=>(0,r.jsxs)("div",{className:"flex items-start space-x-3 p-2 bg-gray-900 rounded-lg",children:[r.jsx("div",{className:"w-4 h-4 flex items-center justify-center mt-0.5",children:r.jsx("i",{className:"ri-thumb-up-line text-green-500"})}),r.jsx("span",{className:"text-gray-300 text-sm",children:e})]},s))})]}),e.concerns.length>0&&(0,r.jsxs)("div",{children:[r.jsx("h4",{className:"font-medium text-red-400 mb-3",children:"Concerns"}),r.jsx("div",{className:"space-y-2",children:e.concerns.map((e,s)=>(0,r.jsxs)("div",{className:"flex items-start space-x-3 p-2 bg-gray-900 rounded-lg",children:[r.jsx("div",{className:"w-4 h-4 flex items-center justify-center mt-0.5",children:r.jsx("i",{className:"ri-alert-line text-red-500"})}),r.jsx("span",{className:"text-gray-300 text-sm",children:e})]},s))})]})]}),"strategy"===l&&(0,r.jsxs)("div",{children:[r.jsx("h4",{className:"font-medium text-blue-400 mb-3",children:"Recommended Follow-up Strategy"}),r.jsx("div",{className:"bg-gray-900 rounded-lg p-4",children:r.jsx("p",{className:"text-gray-300 text-sm leading-relaxed whitespace-pre-line",children:e.recommendedStrategy})}),e.generatedAt&&r.jsx("div",{className:"mt-4 pt-4 border-t border-gray-700",children:(0,r.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,r.jsxs)("span",{children:["Generated by ",e.generatedBy||"AI"]}),r.jsx("span",{children:new Date(e.generatedAt.toDate()).toLocaleDateString()})]})})]})]})]}):r.jsx("div",{className:"bg-gray-800 rounded-lg p-6 border border-gray-700",children:(0,r.jsxs)("div",{className:"text-center py-8",children:[r.jsx("div",{className:"w-16 h-16 mx-auto mb-4 flex items-center justify-center",children:r.jsx("i",{className:"ri-user-line text-4xl text-gray-600"})}),r.jsx("h3",{className:"text-lg font-medium text-gray-400 mb-2",children:"No Persona Available"}),r.jsx("p",{className:"text-gray-500",children:"Buyer persona will appear here after AI analysis"})]})})}function R({recording:e}){var s;let[t,l]=(0,a.useState)(e.engagementReport||null),[n,c]=(0,a.useState)(!1),[d,x]=(0,a.useState)(!1),m=async()=>{if(e.transcript&&!n){c(!0);try{console.log("\uD83D\uDCCA Generating session engagement report...");let s=await (0,j.ox)(e.transcript,e.transcriptSegments||[],e.sentimentMap||[],e.keywordAnalysis||[],e.speakers||[]),t={totalDuration:Math.floor(1800*Math.random())+300,distinctSpeakers:e.speakers?.length||2,sentimentBreakdown:s.sentimentBreakdown,engagementRating:s.engagementRating,keywordsDetected:s.keywordsDetected,questionsAsked:s.questionsAsked,actionItems:s.actionItems,analysisScore:s.analysisScore,generatedAt:new Date},r=(0,i.JU)(o.db,"recordings",e.id);await (0,i.r7)(r,{engagementReport:t,updatedAt:(0,i.Bt)()}),l(t),console.log("✅ Engagement report generated and saved")}catch(e){console.error("❌ Error generating engagement report:",e)}finally{c(!1)}}},u=(e,s)=>s>0?Math.round(e/s*100):0;if(n)return r.jsx("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-500"}),(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"font-medium text-white",children:"Analyzing Session Engagement"}),r.jsx("p",{className:"text-gray-400 text-sm",children:"Generating comprehensive analytics..."})]})]})});if(!t)return(0,r.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("div",{className:"w-5 h-5 flex items-center justify-center",children:r.jsx("i",{className:"ri-bar-chart-line text-blue-500"})}),r.jsx("h3",{className:"font-medium text-white",children:"Session Analytics"})]}),r.jsx("button",{onClick:m,className:"px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded text-sm transition-colors cursor-pointer whitespace-nowrap",children:"Generate Report"})]}),r.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Click to analyze session engagement metrics"})]});let h=t.sentimentBreakdown.positive+t.sentimentBreakdown.neutral+t.sentimentBreakdown.negative;return(0,r.jsxs)("div",{className:"bg-gray-800 rounded-lg border border-gray-700",children:[(0,r.jsxs)("div",{className:"p-4 border-b border-gray-700",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("div",{className:"w-5 h-5 flex items-center justify-center",children:r.jsx("i",{className:"ri-bar-chart-line text-blue-500"})}),r.jsx("h3",{className:"font-medium text-white",children:"Session Analytics"}),(0,r.jsxs)("div",{className:`px-2 py-1 rounded-full text-xs font-medium ${(e=>{switch(e){case"high":return"text-green-400 bg-green-900/30";case"medium":return"text-yellow-400 bg-yellow-900/30";case"low":return"text-red-400 bg-red-900/30";default:return"text-gray-400 bg-gray-900/30"}})(t.engagementRating)}`,children:[t.engagementRating.toUpperCase()," Engagement"]})]}),r.jsx("button",{onClick:()=>x(!d),className:"text-gray-400 hover:text-white transition-colors cursor-pointer",children:r.jsx("div",{className:"w-5 h-5 flex items-center justify-center",children:r.jsx("i",{className:`ri-${d?"arrow-up":"arrow-down"}-s-line`})})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-4 mt-4",children:[(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("div",{className:"text-lg font-bold text-blue-400",children:(s=t.totalDuration,`${Math.floor(s/60)}:${(s%60).toString().padStart(2,"0")}`)}),r.jsx("div",{className:"text-xs text-gray-400",children:"Session Duration"})]}),(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("div",{className:"text-lg font-bold text-green-400",children:t.distinctSpeakers}),r.jsx("div",{className:"text-xs text-gray-400",children:"Speakers"})]}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsxs)("div",{className:"text-lg font-bold text-purple-400",children:[t.analysisScore,"%"]}),r.jsx("div",{className:"text-xs text-gray-400",children:"Analysis Score"})]})]})]}),d&&(0,r.jsxs)("div",{className:"p-4 space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h4",{className:"font-medium text-white mb-3 flex items-center space-x-2",children:[r.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:r.jsx("i",{className:"ri-emotion-line text-yellow-500"})}),r.jsx("span",{children:"Sentiment Analysis"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-green-400 text-sm",children:"Positive"}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("div",{className:"w-24 bg-gray-700 rounded-full h-2",children:r.jsx("div",{className:"bg-green-500 h-2 rounded-full",style:{width:`${u(t.sentimentBreakdown.positive,h)}%`}})}),(0,r.jsxs)("span",{className:"text-gray-300 text-sm w-10 text-right",children:[u(t.sentimentBreakdown.positive,h),"%"]})]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-gray-400 text-sm",children:"Neutral"}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("div",{className:"w-24 bg-gray-700 rounded-full h-2",children:r.jsx("div",{className:"bg-gray-500 h-2 rounded-full",style:{width:`${u(t.sentimentBreakdown.neutral,h)}%`}})}),(0,r.jsxs)("span",{className:"text-gray-300 text-sm w-10 text-right",children:[u(t.sentimentBreakdown.neutral,h),"%"]})]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-red-400 text-sm",children:"Negative"}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("div",{className:"w-24 bg-gray-700 rounded-full h-2",children:r.jsx("div",{className:"bg-red-500 h-2 rounded-full",style:{width:`${u(t.sentimentBreakdown.negative,h)}%`}})}),(0,r.jsxs)("span",{className:"text-gray-300 text-sm w-10 text-right",children:[u(t.sentimentBreakdown.negative,h),"%"]})]})]})]})]}),t.keywordsDetected.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("h4",{className:"font-medium text-white mb-3 flex items-center space-x-2",children:[r.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:r.jsx("i",{className:"ri-key-2-line text-blue-500"})}),r.jsx("span",{children:"Key Topics"})]}),r.jsx("div",{className:"flex flex-wrap gap-2",children:t.keywordsDetected.slice(0,8).map((e,s)=>r.jsx("span",{className:"px-3 py-1 bg-blue-900/30 text-blue-300 rounded-full text-sm",children:e},s))})]}),t.questionsAsked.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("h4",{className:"font-medium text-white mb-3 flex items-center space-x-2",children:[r.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:r.jsx("i",{className:"ri-question-line text-purple-500"})}),(0,r.jsxs)("span",{children:["Client Questions (",t.questionsAsked.length,")"]})]}),r.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:t.questionsAsked.slice(0,5).map((e,s)=>(0,r.jsxs)("div",{className:"flex items-start space-x-2 text-sm",children:[r.jsx("div",{className:"w-4 h-4 flex items-center justify-center mt-0.5",children:r.jsx("i",{className:"ri-question-mark text-purple-400 text-xs"})}),r.jsx("span",{className:"text-gray-300",children:e})]},s))})]}),t.actionItems.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("h4",{className:"font-medium text-white mb-3 flex items-center space-x-2",children:[r.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:r.jsx("i",{className:"ri-task-line text-green-500"})}),(0,r.jsxs)("span",{children:["Action Items (",t.actionItems.length,")"]})]}),r.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:t.actionItems.slice(0,5).map((e,s)=>(0,r.jsxs)("div",{className:"flex items-start space-x-2 text-sm",children:[r.jsx("div",{className:"w-4 h-4 flex items-center justify-center mt-0.5",children:r.jsx("i",{className:"ri-checkbox-circle-line text-green-400 text-xs"})}),r.jsx("span",{className:"text-gray-300",children:e})]},s))})]}),r.jsx("div",{className:"pt-2 border-t border-gray-700",children:(0,r.jsxs)("p",{className:"text-xs text-gray-500",children:["Report generated on ",new Date(t.generatedAt).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})]})})]})]})}function P({recording:e,onBack:s}){var t;let[l,n]=(0,a.useState)("transcript"),[c,d]=(0,a.useState)(null),[x,m]=(0,a.useState)(!1),[u,h]=(0,a.useState)(null),p=async s=>{if(c&&!x){m(!0);try{console.log(` Regenerating follow-up with ${s} tone...`);let t=await (0,j.Fg)(c,s,e.clientName,null);d({...t,tone:s});let r=(0,i.JU)(o.db,"recordings",e.id);await (0,i.r7)(r,{followUpTone:s,aiFollowUpFinal:{...t,tone:s,generatedAt:(0,i.Bt)()},editedByAgent:!0,updatedAt:(0,i.Bt)()}),console.log(` Successfully regenerated and saved follow-up with ${s} tone`)}catch(e){console.error(" Error regenerating follow-up:",e),alert("Failed to regenerate follow-up content. Please try again.")}finally{m(!1)}}},g=async(e,s)=>{try{await navigator.clipboard.writeText(e),h(s),setTimeout(()=>h(null),2e3)}catch(e){console.error("Failed to copy:",e)}};return(0,r.jsxs)("div",{className:"min-h-screen bg-gray-900 pb-20",children:[r.jsx("div",{className:"bg-gray-800 border-b border-gray-700 p-4",children:(0,r.jsxs)("div",{className:"max-w-md mx-auto",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[r.jsx("button",{onClick:s,className:"text-gray-400 hover:text-white transition-colors cursor-pointer",children:r.jsx("div",{className:"w-6 h-6 flex items-center justify-center",children:r.jsx("i",{className:"ri-arrow-left-line text-xl"})})}),(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("h1",{className:"text-xl font-bold text-white",children:e.clientName}),r.jsx("p",{className:"text-gray-400 text-sm",children:(t=e.createdAt)?(t.toDate?t.toDate():new Date(t)).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Unknown date"})]}),r.jsx(({status:e})=>{let s=(()=>{switch(e){case"uploaded":return{color:"text-yellow-400",icon:"ri-upload-line",text:"Uploaded"};case"transcribed":return{color:"text-blue-400",icon:"ri-file-text-line",text:"Transcribed"};case"follow-up-ready":return{color:"text-green-400",icon:"ri-check-line",text:"Analysis Complete"};default:return{color:"text-gray-400",icon:"ri-time-line",text:"Processing"}}})();return(0,r.jsxs)("div",{className:`flex items-center space-x-1 ${s.color}`,children:[r.jsx("div",{className:"w-3 h-3 flex items-center justify-center",children:r.jsx("i",{className:`${s.icon} text-xs`})}),r.jsx("span",{className:"text-xs",children:s.text})]})},{status:e.status})]}),(0,r.jsxs)("div",{className:"bg-gray-900/50 rounded-lg p-3 space-y-2",children:[e.propertyAddress&&(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:r.jsx("i",{className:"ri-home-line text-blue-500"})}),r.jsx("span",{className:"text-gray-300 text-sm",children:e.propertyAddress})]}),e.clientEmail&&(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:r.jsx("i",{className:"ri-mail-line text-green-500"})}),r.jsx("span",{className:"text-gray-300 text-sm",children:e.clientEmail}),r.jsx("button",{onClick:()=>g(e.clientEmail,"email-header"),className:"text-gray-500 hover:text-white transition-colors cursor-pointer",children:r.jsx("div",{className:"w-3 h-3 flex items-center justify-center",children:r.jsx("i",{className:`ri-${"email-header"===u?"check":"file-copy"}-line text-xs`})})})]}),e.clientPhone&&(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:r.jsx("i",{className:"ri-phone-line text-purple-500"})}),r.jsx("span",{className:"text-gray-300 text-sm",children:e.clientPhone}),r.jsx("button",{onClick:()=>g(e.clientPhone,"phone-header"),className:"text-gray-500 hover:text-white transition-colors cursor-pointer",children:r.jsx("div",{className:"w-3 h-3 flex items-center justify-center",children:r.jsx("i",{className:`ri-${"phone-header"===u?"check":"file-copy"}-line text-xs`})})})]}),e.tags&&e.tags.length>0&&(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:r.jsx("i",{className:"ri-price-tag-line text-blue-500"})}),r.jsx("div",{className:"flex flex-wrap gap-1",children:e.tags.map((e,s)=>r.jsx("span",{className:"px-2 py-1 bg-blue-900/30 text-blue-300 rounded-full text-xs",children:e},s))})]}),e.editedByAgent&&(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:r.jsx("i",{className:"ri-edit-line text-orange-500"})}),r.jsx("span",{className:"text-orange-300 text-sm",children:"Modified by agent"})]})]})]})}),r.jsx("div",{className:"bg-gray-800 border-b border-gray-700",children:r.jsx("div",{className:"max-w-md mx-auto px-4",children:(0,r.jsxs)("div",{className:"flex",children:[r.jsx("button",{onClick:()=>n("transcript"),className:`flex-1 px-1 py-3 text-sm font-medium transition-colors cursor-pointer whitespace-nowrap ${"transcript"===l?"text-blue-400 border-b-2 border-blue-400":"text-gray-400 hover:text-white"}`,children:(0,r.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[r.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:r.jsx("i",{className:"ri-file-text-line"})}),r.jsx("span",{children:"Analysis"})]})}),r.jsx("button",{onClick:()=>n("followup"),className:`flex-1 px-1 py-3 text-sm font-medium transition-colors cursor-pointer whitespace-nowrap ${"followup"===l?"text-blue-400 border-b-2 border-blue-400":"text-gray-400 hover:text-white"}`,children:(0,r.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[r.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:r.jsx("i",{className:"ri-robot-line"})}),r.jsx("span",{children:"Follow-up"}),x&&r.jsx("div",{className:"w-3 h-3 flex items-center justify-center",children:r.jsx("div",{className:"animate-spin rounded-full border border-blue-400 border-t-transparent"})})]})}),r.jsx("button",{onClick:()=>n("persona"),className:`flex-1 px-1 py-3 text-sm font-medium transition-colors cursor-pointer whitespace-nowrap ${"persona"===l?"text-blue-400 border-b-2 border-blue-400":"text-gray-400 hover:text-white"}`,children:(0,r.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[r.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:r.jsx("i",{className:"ri-user-star-line"})}),r.jsx("span",{children:"Persona"})]})})]})})}),(0,r.jsxs)("div",{className:"max-w-md mx-auto px-4 py-6",children:["transcript"===l&&(0,r.jsxs)("div",{className:"space-y-6",children:[r.jsx(y,{transcript:e.transcript||"No transcript available",loading:!1,transcriptSegments:e.transcriptSegments||[],sentimentMap:e.sentimentMap||[],keywordAnalysis:e.keywordAnalysis||[],speakers:e.speakers||[],overallSentiment:e.overallSentiment||"neutral"}),r.jsx(R,{recording:e})]}),"followup"===l&&c&&r.jsx(v,{data:c,loading:x,clientEmail:e.clientEmail,clientPhone:e.clientPhone,recordingId:e.id,onToneChange:p,scheduledFollowUp:e.scheduledFollowUp,userId:e.uid,clientName:e.clientName,voiceSummaryUrl:e.voiceSummaries?.followUpSummary?.audioUrl}),"persona"===l&&r.jsx(T,{persona:e.buyerPersona,loading:!1,clientName:e.clientName,voiceSummaryUrl:e.voiceSummaries?.personaSummary?.audioUrl})]})]})}let E=async(e,s)=>{console.log("\uD83C\uDF99️ TRANSCRIPTION: Starting AssemblyAI transcription for audio URL:",e);let t="6bc50afa1cec484aa2947874b1871dda";if(!t)return console.error("\uD83D\uDEA8 TRANSCRIPTION ERROR: AssemblyAI API key not found in environment variables"),null;try{let r=await fetch("https://api.assemblyai.com/v2/transcript",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({audio_url:e,language_code:"en_us",punctuate:!0,format_text:!0,speaker_labels:!0,auto_chapters:!1,summarization:!1})});if(!r.ok)throw Error(`AssemblyAI submission failed: ${r.status} ${r.statusText}`);let a=await r.json();console.log("\uD83D\uDCE4 TRANSCRIPTION: Submitted to AssemblyAI, transcript ID:",a.id);let i=a.id,l=0;for(;l<100;){await new Promise(e=>setTimeout(e,3e3)),l++,console.log(`🔄 TRANSCRIPTION: Polling attempt ${l}/100 for transcript ${i}`);let e=await fetch(`https://api.assemblyai.com/v2/transcript/${i}`,{method:"GET",headers:{Authorization:`Bearer ${t}`}});if(!e.ok)throw Error(`AssemblyAI status check failed: ${e.status} ${e.statusText}`);let r=await e.json();if(console.log("\uD83D\uDCCA TRANSCRIPTION STATUS:",r.status),"completed"===r.status){console.log("✅ TRANSCRIPTION: Completed successfully");let e=r.text||"";return s&&e&&(await I(s,e,"transcribed"),console.log("\uD83D\uDCBE FIRESTORE: Updated recording document with transcript")),e}if("error"===r.status)return console.error("\uD83D\uDEA8 TRANSCRIPTION ERROR:",r.error),s&&await I(s,null,"transcription-failed"),null}return console.error("⏰ TRANSCRIPTION ERROR: Polling timeout reached after",300,"seconds"),s&&await I(s,null,"transcription-failed"),null}catch(e){if(console.error("\uD83D\uDEA8 TRANSCRIPTION ERROR:",e),s)try{await I(s,null,"transcription-failed")}catch(e){console.error("\uD83D\uDEA8 FIRESTORE UPDATE ERROR:",e)}return null}},I=async(e,s,t)=>{try{let r=(0,i.JU)(o.db,"recordings",e),a={status:t,transcribedAt:(0,i.Bt)(),updatedAt:(0,i.Bt)()};s&&(a.transcript=s),await (0,i.r7)(r,a),console.log(`💾 FIRESTORE: Updated recording ${e} with status: ${t}`)}catch(e){throw console.error("\uD83D\uDEA8 FIRESTORE UPDATE ERROR:",e),e}};var $=t(1552),F=t(7463);function q(){let[e,s]=(0,a.useState)(null),[t,x]=(0,a.useState)(""),[m,u]=(0,a.useState)(null),[p,f]=(0,a.useState)(!1),[b,N]=(0,a.useState)(!1),[w,S]=(0,a.useState)("form"),[C,k]=(0,a.useState)(!1),[A,D]=(0,a.useState)(!0),[T,R]=(0,a.useState)([]),[I,q]=(0,a.useState)(null),[O,U]=(0,a.useState)(null),[B,M]=(0,a.useState)(!1),{user:L}=(0,d.a)(),_=async(t,r)=>{if(!e){console.error("❌ NO CURRENT SESSION: Cannot save recording without session data");return}if(!L?.uid){console.error("❌ NO USER UID: Cannot save recording without authenticated user");return}console.log("=== RECORDING PROCESSING START ==="),console.log("Current session data:",e),console.log("User UID:",L.uid),f(!0),S("results");try{console.log("\uD83D\uDCE4 UPLOAD: Starting audio upload to Firebase Storage...");let a=`recording-${Date.now()}-${(0,F.Z)()}.wav`,l=new File([t],a,{type:"audio/wav"}),n=(0,$.iH)(o.tO,`recordings/${L.uid}/${a}`),c=async(e=3)=>{for(let s=1;s<=e;s++)try{console.log(`📤 Upload attempt ${s}/${e}`);let t=(0,$.KV)(n,l),r=new Promise((e,s)=>setTimeout(()=>s(Error("Upload timeout after 30 seconds")),3e4));await Promise.race([t,r]);let a=await (0,$.Jt)(n);return console.log("✅ UPLOAD: Audio uploaded successfully:",a),a}catch(t){if(console.error(`❌ Upload attempt ${s} failed:`,t),s===e)throw Error("Firebase Storage upload failed. Please check your internet connection and try again.");await new Promise(e=>setTimeout(e,1e3*s))}throw Error("Upload failed after all retries")},d=await c(),m={uid:L.uid,audioPath:d,clientName:e.clientName,clientEmail:e.clientEmail,clientPhone:e.clientPhone,tags:e.tags,propertyId:e.propertyId,propertyAddress:e.propertyAddress,status:"uploaded",createdAt:(0,i.Bt)()};console.log("\uD83D\uDD25 FIRESTORE: Saving recording document with data:",m);let h=await (0,i.ET)((0,i.hJ)(o.db,"recordings"),m);console.log("✅ FIRESTORE: Recording document created with ID:",h.id,"status: uploaded"),console.log("\uD83C\uDFAF TRANSCRIPTION: Starting audio transcription...");try{let t=await E(d);console.log("✅ TRANSCRIPTION: Transcript generated successfully"),x(t??""),await (0,i.r7)(h,{transcript:t??"",status:"transcribed",updatedAt:(0,i.Bt)()}),console.log("✅ FIRESTORE: Recording updated with transcript, status: transcribed");let a={...e,transcript:t??"",recordingDuration:r};if(s(a),console.log("\uD83E\uDD16 AI: Starting AI follow-up generation via Cloud Function..."),N(!0),t)try{let s=await (0,j.cu)(t,e.clientName);u(s),await (0,i.r7)(h,{summary:s.preferences,smsText:s.sms,emailText:s.email,status:"follow-up-ready",updatedAt:(0,i.Bt)()}),console.log("✅ AI: Follow-up content generated and saved, status: follow-up-ready")}catch(r){console.error("❌ AI GENERATION ERROR:",r);let s={preferences:"Unable to generate preferences summary. Please try again later.",objections:"Unable to generate objections summary. Please try again later.",sms:`Hi ${e.clientName}! Thanks for visiting the property today. Let me know if you have any questions!`,email:`Hi ${e.clientName},

Thank you for taking the time to view the property today. I hope you found it interesting.

Please let me know if you have any questions or would like to schedule another viewing.

Best regards,
[Your Name]`,urgencyLevel:"medium",keyTopics:["Property viewing","Client discussion"],recommendedActions:["Schedule follow-up call","Send property information"],tone:"professional"};u(s);let t="Unknown error";r instanceof Error&&(t=r.message),await (0,i.r7)(h,{summary:"AI generation failed - please try again later",smsText:s.sms,emailText:s.email,status:"follow-up-ready",errorMessage:t,updatedAt:(0,i.Bt)()})}N(!1)}catch(s){console.error("❌ TRANSCRIPTION ERROR:",s);let e="Transcription failed.";s instanceof Error&&(e="Transcription failed: "+s.message),await (0,i.r7)(h,{status:"transcription-failed",errorMessage:e,updatedAt:(0,i.Bt)()}),x("Transcription service is currently unavailable. Please try again later."),N(!1)}f(!1)}catch(s){console.error("❌ RECORDING PROCESSING ERROR:",s);let e="Recording upload failed. Please try again.";s instanceof Error&&(s.message.includes("Emulator")?e="Firebase Emulator connection failed. Please start the Firebase emulators and try again.":s.message.includes("timeout")&&(e="Upload timeout. Please check your internet connection and try again.")),alert(e),f(!1),N(!1),S("recording")}},z=()=>{k(!0),s(null),x(""),u(null),S("form"),q(null)},G=e=>e.toDate().toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}),H=e=>{if(!e)return"No transcript available";let s=e.split(". ");return s.slice(0,2).join(". ")+(s.length>2?"...":"")},Z=async(e,s)=>{try{await navigator.clipboard.writeText(e),U(s),setTimeout(()=>U(null),2e3)}catch(e){console.error("Failed to copy:",e)}},K=({status:e})=>{let s=(()=>{switch(e){case"uploaded":return{color:"text-yellow-400",icon:"ri-upload-line",text:"Uploaded"};case"transcribed":return{color:"text-blue-400",icon:"ri-file-text-line",text:"Transcribed"};case"follow-up-ready":return{color:"text-green-400",icon:"ri-check-line",text:"Follow-up Ready"};default:return{color:"text-gray-400",icon:"ri-time-line",text:"Processing"}}})();return(0,r.jsxs)("div",{className:`flex items-center space-x-1 ${s.color}`,children:[r.jsx("div",{className:"w-3 h-3 flex items-center justify-center",children:r.jsx("i",{className:`${s.icon} text-xs`})}),r.jsx("span",{className:"text-xs",children:s.text})]})};return I?(0,r.jsxs)(l.Z,{children:[r.jsx(P,{recording:I,onBack:()=>q(null)}),r.jsx(c.Z,{})]}):C?r.jsx(l.Z,{children:(0,r.jsxs)("div",{className:"min-h-screen bg-gray-900 pb-20",children:[r.jsx(n.Z,{}),(0,r.jsxs)("div",{className:"max-w-md mx-auto px-4 py-6 space-y-6",children:["form"===w&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[r.jsx("button",{onClick:()=>{k(!1),s(null),x(""),u(null),S("form"),q(null)},className:"text-gray-400 hover:text-white transition-colors cursor-pointer",children:r.jsx("div",{className:"w-6 h-6 flex items-center justify-center",children:r.jsx("i",{className:"ri-arrow-left-line text-xl"})})}),(0,r.jsxs)("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-white",children:"New Recording Session"}),r.jsx("p",{className:"text-gray-400",children:"Enter client details to begin"})]})]}),r.jsx(h,{onSubmit:e=>{console.log("=== CLIENT FORM SUBMITTED ==="),console.log("\uD83C\uDFE0 LINK TO PROPERTY ID:",{propertyId:e.propertyId,propertyAddress:e.propertyAddress}),s({...e,transcript:"",recordingDuration:0}),S("recording")}})]}),"recording"===w&&e&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[r.jsx("button",{onClick:()=>S("form"),className:"text-gray-400 hover:text-white transition-colors cursor-pointer",children:r.jsx("div",{className:"w-6 h-6 flex items-center justify-center",children:r.jsx("i",{className:"ri-arrow-left-line text-xl"})})}),(0,r.jsxs)("div",{children:[r.jsx("h1",{className:"text-xl font-bold text-white",children:e.clientName}),r.jsx("p",{className:"text-gray-400",children:e.propertyAddress}),(0,r.jsxs)("div",{className:"flex items-center justify-center space-x-4 text-sm text-gray-500 mt-2",children:[e.clientEmail&&(0,r.jsxs)("div",{className:"flex items-center space-x-1",children:[r.jsx("div",{className:"w-3 h-3 flex items-center justify-center",children:r.jsx("i",{className:"ri-mail-line"})}),r.jsx("span",{children:e.clientEmail})]}),e.clientPhone&&(0,r.jsxs)("div",{className:"flex items-center space-x-1",children:[r.jsx("div",{className:"w-3 h-3 flex items-center justify-center",children:r.jsx("i",{className:"ri-phone-line"})}),r.jsx("span",{children:e.clientPhone})]})]}),e.tags&&e.tags.length>0&&r.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:e.tags.map((e,s)=>r.jsx("span",{className:"px-2 py-1 bg-blue-900/30 text-blue-300 rounded-full text-xs",children:e},s))})]})]}),r.jsx("div",{className:"bg-gray-800 rounded-lg p-8 text-center border border-gray-700",children:r.jsx(g,{onRecordingComplete:_})})]}),"results"===w&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("h1",{className:"text-xl font-bold text-white",children:e?.clientName}),r.jsx("p",{className:"text-gray-400",children:e?.propertyAddress})]}),t&&r.jsx(y,{transcript:t,loading:p}),m&&r.jsx(v,{data:m,loading:b,clientEmail:e?.clientEmail,clientPhone:e?.clientPhone}),r.jsx("button",{onClick:z,className:"w-full py-3 px-4 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors cursor-pointer whitespace-nowrap",children:"Start New Session"})]})]}),r.jsx(c.Z,{})]})}):r.jsx(l.Z,{children:(0,r.jsxs)("div",{className:"min-h-screen bg-gray-900 pb-20",children:[r.jsx(n.Z,{}),(0,r.jsxs)("div",{className:"max-w-md mx-auto px-4 py-6",children:[(0,r.jsxs)("div",{className:"mb-6",children:[r.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"Record"}),r.jsx("p",{className:"text-gray-400",children:"Start a new recording or view past sessions"})]}),(0,r.jsxs)("button",{onClick:z,className:"w-full py-4 px-6 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors cursor-pointer whitespace-nowrap mb-8 flex items-center justify-center space-x-2",children:[r.jsx("div",{className:"w-5 h-5 flex items-center justify-center",children:r.jsx("i",{className:"ri-mic-line"})}),r.jsx("span",{children:"Start Recording"})]}),r.jsx("div",{className:"mb-4",children:r.jsx("h2",{className:"text-lg font-semibold text-white mb-3",children:"Recording History"})}),A?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mb-3"}),r.jsx("p",{className:"text-gray-400 text-sm",children:"Loading your recordings..."})]}):L?0===T.length?(0,r.jsxs)("div",{className:"text-center py-12",children:[r.jsx("div",{className:"w-16 h-16 mx-auto mb-4 flex items-center justify-center",children:r.jsx("i",{className:"ri-mic-off-line text-4xl text-gray-600"})}),r.jsx("h3",{className:"text-lg font-medium text-gray-400 mb-2",children:"No recordings yet"}),r.jsx("p",{className:"text-gray-500",children:"Start your first recording session above"})]}):r.jsx("div",{className:"space-y-4",children:T.map(e=>(0,r.jsxs)("div",{onClick:()=>q(e),className:"bg-gray-800 rounded-lg p-4 border border-gray-700 hover:border-gray-600 transition-colors cursor-pointer",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("h3",{className:"font-medium text-white",children:e.clientName}),r.jsx(K,{status:e.status})]}),e.propertyAddress&&r.jsx("p",{className:"text-sm text-gray-400 mb-2 truncate",children:e.propertyAddress}),e.tags&&e.tags.length>0&&r.jsx("div",{className:"flex flex-wrap gap-1 mb-3",children:e.tags.map((e,s)=>r.jsx("span",{className:"px-2 py-1 bg-blue-900/30 text-blue-300 rounded-full text-xs",children:e},s))}),e.transcript&&(0,r.jsxs)("div",{className:"mb-3",children:[r.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Transcript Preview:"}),r.jsx("p",{className:"text-sm text-gray-300 italic leading-relaxed",children:H(e.transcript)})]}),(e.smsText||e.emailText)&&(0,r.jsxs)("div",{className:"mb-3 space-y-2",children:[e.smsText&&(0,r.jsxs)("div",{className:"bg-gray-900 rounded p-2",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("div",{className:"w-3 h-3 flex items-center justify-center",children:r.jsx("i",{className:"ri-message-3-line text-green-500"})}),r.jsx("span",{className:"text-xs text-green-400 font-medium",children:"SMS"})]}),r.jsx("button",{onClick:s=>{s.stopPropagation(),Z(e.smsText,`sms-${e.id}`)},className:"text-xs text-gray-400 hover:text-green-400 transition-colors cursor-pointer",children:O===`sms-${e.id}`?"Copied":"Copy"})]}),r.jsx("p",{className:"text-xs text-gray-300 line-clamp-2",children:e.smsText.length>80?`${e.smsText.substring(0,80)}...`:e.smsText})]}),e.emailText&&(0,r.jsxs)("div",{className:"bg-gray-900 rounded p-2",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("div",{className:"w-3 h-3 flex items-center justify-center",children:r.jsx("i",{className:"ri-mail-line text-blue-500"})}),r.jsx("span",{className:"text-xs text-blue-400 font-medium",children:"Email"})]}),r.jsx("button",{onClick:s=>{s.stopPropagation(),Z(e.emailText,`email-${e.id}`)},className:"text-xs text-gray-400 hover:text-blue-400 transition-colors cursor-pointer",children:O===`email-${e.id}`?"Copied":"Copy"})]}),r.jsx("p",{className:"text-xs text-gray-300 line-clamp-2",children:e.emailText.length>80?`${e.emailText.substring(0,80)}...`:e.emailText})]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-xs text-gray-500",children:G(e.createdAt)}),r.jsx("div",{className:"w-4 h-4 flex items-center justify-center",children:r.jsx("i",{className:"ri-arrow-right-s-line text-gray-500"})})]})]},e.id))}):(0,r.jsxs)("div",{className:"text-center py-12",children:[r.jsx("div",{className:"w-16 h-16 mx-auto mb-4 flex items-center justify-center",children:r.jsx("i",{className:"ri-user-line text-4xl text-gray-600"})}),r.jsx("h3",{className:"text-lg font-medium text-gray-400 mb-2",children:"Please sign in"}),r.jsx("p",{className:"text-gray-500",children:"Sign in to view your recording history"})]})]}),r.jsx(c.Z,{})]})})}},4321:(e,s,t)=>{"use strict";t.d(s,{Z:()=>i});var r=t(326),a=t(7577);function i({value:e,onChange:s,placeholder:t="Type tags separated by commas...",label:i="Tags",className:l="",disabled:n=!1}){let[c,o]=(0,a.useState)(""),d=()=>{if(!c.trim())return;let t=c.split(",").map(e=>e.trim()).filter(e=>e.length>0).filter(s=>!e.includes(s));t.length>0&&(s([...e,...t]),o(""))},x=t=>{s(e.filter(e=>e!==t))};return(0,r.jsxs)("div",{className:l,children:[i&&(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:[i,r.jsx("span",{className:"text-gray-500 text-xs ml-2",children:"(comma-separated)"})]}),r.jsx("input",{type:"text",value:c,onChange:e=>{o(e.target.value)},onKeyDown:e=>{("Enter"===e.key||","===e.key)&&(e.preventDefault(),d())},onBlur:()=>{d()},placeholder:t,disabled:n,className:"w-full px-4 py-3 border border-gray-700 rounded-lg bg-gray-800 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm disabled:opacity-50 disabled:cursor-not-allowed"}),e.length>0&&r.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:e.map((e,s)=>(0,r.jsxs)("span",{className:"px-2 py-1 bg-blue-900/30 text-blue-300 rounded-full text-xs flex items-center space-x-1 group",children:[r.jsx("span",{children:e}),!n&&r.jsx("button",{type:"button",onClick:()=>x(e),className:"text-blue-400 hover:text-blue-200 transition-colors cursor-pointer",children:r.jsx("div",{className:"w-3 h-3 flex items-center justify-center",children:r.jsx("i",{className:"ri-close-line text-xs"})})})]},s))})]})}},7463:(e,s,t)=>{"use strict";t.d(s,{Z:()=>o});var r=t(6005),a=t.n(r);let i={randomUUID:a().randomUUID},l=new Uint8Array(256),n=l.length,c=[];for(let e=0;e<256;++e)c.push((e+256).toString(16).slice(1));let o=function(e,s,t){if(i.randomUUID&&!s&&!e)return i.randomUUID();let r=(e=e||{}).random||(e.rng||function(){return n>l.length-16&&(a().randomFillSync(l),n=0),l.slice(n,n+=16)})();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,s){t=t||0;for(let e=0;e<16;++e)s[t+e]=r[e];return s}return function(e,s=0){return(c[e[s+0]]+c[e[s+1]]+c[e[s+2]]+c[e[s+3]]+"-"+c[e[s+4]]+c[e[s+5]]+"-"+c[e[s+6]]+c[e[s+7]]+"-"+c[e[s+8]]+c[e[s+9]]+"-"+c[e[s+10]]+c[e[s+11]]+c[e[s+12]]+c[e[s+13]]+c[e[s+14]]+c[e[s+15]]).toLowerCase()}(r)}},908:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>r});let r=(0,t(8570).createProxy)(String.raw`C:\NB\showAI_V3\app\page.tsx#default`)}};var s=require("../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[916,379,226,502],()=>t(2576));module.exports=r})();