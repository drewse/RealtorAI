"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[432],{4432:function(e,n,o){o.d(n,{Fg:function(){return a},cu:function(){return p},kN:function(){return t},ox:function(){return l},s_:function(){return r},uI:function(){return i}});let t=async(e,n,o,t,a,r)=>{try{var i,l,s,c,u,d,p,m,y,g,f,h,v,w,k,S,b,D,C;console.log("\uD83C\uDF99️ Generating enhanced AI follow-up with advanced analysis..."),console.log("\uD83C\uDFE0 Property Context:",a),console.log("\uD83D\uDD0D Analysis Options:",r);let T="https://generateaifollowup-x5dsxztz7q-uc.a.run.app";console.log("\uD83D\uDD17 Using enhanced function URL:",T);let x={audioUrl:e,tags:n,sessionId:o||null,clientName:t||null,propertyContext:a||null,followUpTone:(null==r?void 0:r.followUpTone)||"professional",speakerSeparation:(null==r?void 0:r.speakerSeparation)||!0,sentimentAnalysis:(null==r?void 0:r.sentimentAnalysis)||!0,keywordExtraction:(null==r?void 0:r.keywordExtraction)||!0,generatePersona:(null==r?void 0:r.generatePersona)||!0,generateVoiceSummary:(null==r?void 0:r.generateVoiceSummary)||!0};console.log("\uD83D\uDCE4 Enhanced request payload:",x);let E=await fetch(T,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(x)});if(!E.ok){let e=await E.json().catch(()=>null);throw console.error("❌ Enhanced Cloud Function error:",{status:E.status,statusText:E.statusText,error:e}),Error((null==e?void 0:e.message)||"Cloud Function request failed: ".concat(E.status))}let A=await E.json();if(!A.success||!A.data)throw Error("Invalid response format from Enhanced Cloud Function");return console.log("✅ Enhanced AI follow-up generated successfully via backend"),console.log("\uD83D\uDCCA Enhanced Metadata:",A.metadata),console.log("\uD83C\uDF99️ Transcription method:",null===(i=A.metadata)||void 0===i?void 0:i.transcriptionMethod),console.log("\uD83C\uDFE0 Property context processed:",!!(null===(l=A.metadata)||void 0===l?void 0:l.propertyContext)),console.log("\uD83D\uDC64 Buyer persona generated:",!!(null===(s=A.metadata)||void 0===s?void 0:s.buyerPersona)),console.log("\uD83D\uDD0A Voice summaries generated:",!!(null===(c=A.metadata)||void 0===c?void 0:c.voiceSummaries)),console.log("\uD83D\uDD0D Analysis features:",{speakerSeparation:!!(null===(u=A.metadata)||void 0===u?void 0:u.transcriptSegments),sentimentAnalysis:!!(null===(d=A.metadata)||void 0===d?void 0:d.sentimentMap),keywordExtraction:!!(null===(p=A.metadata)||void 0===p?void 0:p.keywordAnalysis),personaGeneration:!!(null===(m=A.metadata)||void 0===m?void 0:m.buyerPersona),voiceSummary:!!(null===(y=A.metadata)||void 0===y?void 0:y.voiceSummaries)}),{followUp:A.data,transcript:null===(g=A.metadata)||void 0===g?void 0:g.transcript,transcriptionMethod:null===(f=A.metadata)||void 0===f?void 0:f.transcriptionMethod,propertyContext:null===(h=A.metadata)||void 0===h?void 0:h.propertyContext,transcriptSegments:(null===(v=A.metadata)||void 0===v?void 0:v.transcriptSegments)||[],sentimentMap:(null===(w=A.metadata)||void 0===w?void 0:w.sentimentMap)||[],keywordAnalysis:(null===(k=A.metadata)||void 0===k?void 0:k.keywordAnalysis)||[],speakers:(null===(S=A.metadata)||void 0===S?void 0:S.speakers)||[],overallSentiment:(null===(b=A.metadata)||void 0===b?void 0:b.overallSentiment)||"neutral",buyerPersona:(null===(D=A.metadata)||void 0===D?void 0:D.buyerPersona)||null,voiceSummaries:(null===(C=A.metadata)||void 0===C?void 0:C.voiceSummaries)||null,metadata:A.metadata}}catch(e){return console.error("❌ Error generating enhanced AI follow-up:",e),{followUp:{preferences:"Unable to analyze audio, tags, and property details. The AI service is temporarily unavailable. Error: ".concat(e instanceof Error?e.message:"Unknown error"),objections:"Unable to identify concerns from audio and property context. The AI service is temporarily unavailable. Error: ".concat(e instanceof Error?e.message:"Unknown error"),sms:"Hi ".concat(t||"Client","! Thanks for visiting the property today. Let me know if you have any questions!"),email:"Hi ".concat(t||"Client",",\n\nThank you for taking the time to view the property today. I hope you found it interesting and that it meets some of your requirements.\n\nI'd love to hear your thoughts and answer any questions you might have. Please don't hesitate to reach out if you need any additional information or would like to schedule another viewing.\n\nLooking forward to hearing from you soon!\n\nBest regards,\n[Your Name]"),urgencyLevel:"medium",keyTopics:[...n,"property viewing","client feedback",...(null==a?void 0:a.propertyFeatures)||[]],recommendedActions:["Send follow-up message","Schedule callback","Prepare additional information"],tone:(null==r?void 0:r.followUpTone)||"professional"},transcript:null,transcriptionMethod:"fallback",propertyContext:a||null,transcriptSegments:[],sentimentMap:[],keywordAnalysis:[],speakers:[],overallSentiment:"neutral",buyerPersona:null,voiceSummaries:null,metadata:{error:e instanceof Error?e.message:"Unknown error"}}}},a=async(e,n,o,t)=>{try{console.log("\uD83C\uDFA8 Regenerating follow-up with ".concat(n," tone..."));let a="Transform the following real estate follow-up content to match a ".concat(n," tone:\n\n    Original Content:\n    - Preferences: ").concat(e.preferences,"\n    - Objections: ").concat(e.objections,"\n    - SMS: ").concat(e.sms,"\n    - Email: ").concat(e.email,"\n    \n    Client: ").concat(o,"\n    ").concat(t?"Property: ".concat(t.propertyType," at ").concat(t.address):"","\n\n    Please rewrite all content to match a ").concat(n," tone while maintaining the core information. Return in the same JSON format."),r=await p(a,o,void 0,t,{followUpTone:n});return console.log("✅ Successfully regenerated follow-up with ".concat(n," tone")),r}catch(o){return console.error("❌ Error regenerating follow-up with ".concat(n," tone:"),o),e}},r=async(e,n,o,t,a)=>{try{var r,i;console.log("\uD83D\uDC64 Generating buyer persona from transcript and context...");let l="Analyze this real estate showing conversation to generate a comprehensive buyer persona:\n\n    Client Name: ".concat(o||"Unknown","\n    Transcript: ").concat(e,"\n    Tags: ").concat(n.join(", "),"\n    ").concat(t?"\n    Property Context:\n    - Address: ".concat(t.address,"\n    - Type: ").concat(t.propertyType,"\n    - Price: $").concat(null===(r=t.price)||void 0===r?void 0:r.toLocaleString(),"\n    - Size: ").concat(t.bedrooms," bed, ").concat(t.bathrooms," bath\n    - Features: ").concat(null===(i=t.propertyFeatures)||void 0===i?void 0:i.join(", ")):"",'\n\n    Generate a detailed buyer persona in JSON format:\n    {\n      "clientName": "').concat(o||"",'",\n      "buyerType": "Select from: Investor, First-Time Buyer, Upsizer, Downsizer, Relocator, Second Home, Other",\n      "keyMotivations": ["primary motivation 1", "motivation 2", "motivation 3"],\n      "decisionTimeline": "Select from: Immediate, Within 30 Days, 2-3 Months, 6+ Months, Exploring",\n      "budgetRange": {\n        "min": estimated_min_budget,\n        "max": estimated_max_budget,\n        "flexibility": "Select from: Strict, Flexible, Very Flexible"\n      },\n      "locationPreferences": ["preferred area 1", "area 2"],\n      "propertyFeaturePriorities": ["most important feature", "feature 2", "feature 3"],\n      "emotionalProfile": "Select from: Analytical, Enthusiastic, Cautious, Decisive, Social",\n      "communicationPreference": "Select from: Email, Phone, Text, In-Person, Mixed",\n      "concerns": ["primary concern 1", "concern 2"],\n      "positiveSignals": ["positive reaction 1", "reaction 2"],\n      "recommendedStrategy": "Detailed follow-up strategy based on analysis",\n      "confidenceScore": 0.85\n    }\n\n    Base your analysis on actual conversation content, not assumptions.'),s=await fetch("https://generatebuyerpersona-x5dsxztz7q-uc.a.run.app",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:l,transcript:e,tags:n,clientName:o||"Client",propertyContext:t||null,sessionId:a||null})});if(!s.ok)throw Error("Persona generation failed: ".concat(s.status));let c=await s.json();if(!c.success||!c.data)throw Error("Invalid persona response format");return console.log("✅ Buyer persona generated successfully"),c.data}catch(e){return console.error("❌ Error generating buyer persona:",e),{clientName:o||"",buyerType:"Other",keyMotivations:["Property viewing","Information gathering"],decisionTimeline:"Exploring",budgetRange:{min:(null==t?void 0:t.price)?.8*t.price:0,max:(null==t?void 0:t.price)?1.2*t.price:0,flexibility:"Flexible"},locationPreferences:[(null==t?void 0:t.address)?"Current area":"Unknown"],propertyFeaturePriorities:n.length>0?n.slice(0,3):["General features"],emotionalProfile:"Cautious",communicationPreference:"Mixed",concerns:["Need more information"],positiveSignals:["Attended showing"],recommendedStrategy:"Follow up with additional information and schedule callback",confidenceScore:.5,generatedAt:new Date().toISOString(),generatedBy:"fallback"}}},i=async(e,n,o,t)=>{try{console.log("\uD83D\uDCC5 Scheduling ".concat(n," follow-up delivery for recording ").concat(e));let a=await fetch("https://schedulefollowup-x5dsxztz7q-uc.a.run.app",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({recordingId:e,method:n,sendAt:o.toISOString(),userId:t})});if(!a.ok)throw Error("Follow-up scheduling failed: ".concat(a.status));if(!(await a.json()).success)throw Error("Failed to schedule follow-up");return console.log("✅ Follow-up scheduled successfully"),!0}catch(e){return console.error("❌ Error scheduling follow-up:",e),!1}},l=async(e,n,o,t,a)=>{try{console.log("\uD83D\uDCCA Generating comprehensive session analytics...");let a={positive:0,neutral:0,negative:0};o.length>0?o.forEach(e=>{a[e.sentiment]++}):e.split(/[.!?]+/).filter(e=>e.trim().length>0).forEach(e=>{let n=s(e);a[n]++});let r=[];r=t.length>0?t.sort((e,n)=>n.relevance-e.relevance).slice(0,10).map(e=>e.word):c(e);let i=u(e,n),l=d(e),p=a.positive+a.neutral+a.negative,m=p>0?a.positive/p:0,y=i.length,g="low";m>.6&&y>3?g="high":(m>.3||y>1)&&(g="medium");let f=Math.min(100,Math.round(30*m+25*Math.min(y/5,1)+25*Math.min(r.length/10,1)+20*Math.min(l.length/3,1)));return console.log("✅ Session analytics generated:",{sentimentBreakdown:a,engagementRating:g,analysisScore:f,questionsCount:i.length,keywordsCount:r.length}),{sentimentBreakdown:a,engagementRating:g,keywordsDetected:r,questionsAsked:i,actionItems:l,analysisScore:f}}catch(e){return console.error("❌ Error generating session analytics:",e),{sentimentBreakdown:{positive:1,neutral:2,negative:0},engagementRating:"medium",keywordsDetected:["property","price","location"],questionsAsked:["What are your thoughts on this property?"],actionItems:["Follow up with client","Send additional information"],analysisScore:65}}},s=e=>{let n=e.toLowerCase(),o=["good","great","excellent","love","like","perfect","amazing","beautiful","nice","wonderful"].filter(e=>n.includes(e)).length,t=["bad","hate","terrible","awful","dislike","problem","issue","concern","worry","expensive"].filter(e=>n.includes(e)).length;return o>t?"positive":t>o?"negative":"neutral"},c=e=>{let n=e.toLowerCase();return["price","location","neighborhood","schools","commute","size","bedrooms","bathrooms","kitchen","garage","yard","basement","attic","renovation","condition","market","investment","mortgage","down payment","closing","inspection","appraisal"].filter(e=>n.includes(e)).slice(0,10)},u=(e,n)=>{let o=[];if(n.length>0)n.forEach(e=>{if("Client"===e.speaker&&e.text.includes("?")){let n=e.text.split("?").filter(e=>e.trim().length>5);o.push(...n.map(e=>e.trim()+"?"))}});else{let n=e.split(/[.!]/).filter(e=>e.includes("?"));o.push(...n.map(e=>e.trim()))}return o.slice(0,8)},d=e=>{let n=["follow up","call back","send information","schedule","arrange","provide","get back to","check on","look into","research","find out","contact"],o=e.split(/[.!?]+/).map(e=>e.trim()).filter(e=>e.length>10),t=[];return o.forEach(e=>{let o=e.toLowerCase();n.some(e=>o.includes(e))&&t.push(e)}),t.slice(0,5)},p=async(e,n,o,t,a)=>{try{console.log("\uD83E\uDD16 Generating enhanced AI follow-up via secure backend..."),console.log("\uD83C\uDFE0 Property Context Available:",!!t),console.log("\uD83D\uDD0D Analysis Options:",a);let s="You are an expert real estate assistant with advanced conversation analysis capabilities. Based on this transcript, provide comprehensive analysis and generate personalized follow-up messages.\n    \n\n    Client: ".concat(n,"\n    Conversation Transcript: ").concat(e,"\n    Follow-up Tone: ").concat((null==a?void 0:a.followUpTone)||"professional");if(t){var r,i,l;s+="\n\n    \n\n    PROPERTY CONTEXT:\n    Address: ".concat(t.address,"\n    Type: ").concat(t.propertyType,"\n    Price: $").concat(null===(r=t.price)||void 0===r?void 0:r.toLocaleString(),"\n    Size: ").concat(t.bedrooms," bed, ").concat(t.bathrooms," bath, ").concat(null===(i=t.sqft)||void 0===i?void 0:i.toLocaleString()," sqft\n    ").concat(t.lotSize?"Lot Size: ".concat(t.lotSize.toLocaleString()," sqft"):"","\n    ").concat(t.yearBuilt?"Year Built: ".concat(t.yearBuilt):"","\n    ").concat(t.parking?"Parking: ".concat(t.parking):"","\n    Status: ").concat(t.status,"\n    ").concat((null===(l=t.propertyFeatures)||void 0===l?void 0:l.length)>0?"Features: ".concat(t.propertyFeatures.join(", ")):"")}s+="\n\n    \n\n    ANALYSIS REQUIREMENTS:\n    ".concat((null==a?void 0:a.speakerSeparation)?"- Identify and separate speaker segments (Agent vs Client)":"","\n    ").concat((null==a?void 0:a.sentimentAnalysis)?"- Analyze sentiment for each conversation segment":"","\n    ").concat((null==a?void 0:a.keywordExtraction)?"- Extract key topics and relevant keywords with frequency analysis":"","\n    ").concat((null==a?void 0:a.generatePersona)?"- Generate detailed buyer persona based on conversation":"",'\n    \n\n    Please provide a comprehensive analysis and follow-up content in JSON format:\n    \n\n    {\n      "preferences": "Detailed client preferences with property context",\n      "objections": "Main concerns with property-specific considerations", \n      "sms": "Personalized SMS in ').concat((null==a?void 0:a.followUpTone)||"professional",' tone (160 char max)",\n      "email": "Professional email in ').concat((null==a?void 0:a.followUpTone)||"professional",' tone with property details",\n      "urgencyLevel": "low|medium|high based on client interest",\n      "keyTopics": ["specific topics discussed with property context"],\n      "recommendedActions": ["specific next steps with property considerations"],\n      "tone": "').concat((null==a?void 0:a.followUpTone)||"professional",'",\n      ').concat((null==a?void 0:a.speakerSeparation)?'"transcriptSegments": [{"speaker": "Agent|Client", "text": "segment text", "sentiment": "positive|neutral|negative"}],':"","\n      ").concat((null==a?void 0:a.sentimentAnalysis)?'"sentimentMap": [{"sentence": "text", "sentiment": "positive|neutral|negative", "confidence": 0.8}],':"","\n      ").concat((null==a?void 0:a.keywordExtraction)?'"keywordAnalysis": [{"word": "keyword", "frequency": 3, "relevance": 0.9, "category": "property|price|concern|positive|negative"}],':"","\n      ").concat((null==a?void 0:a.speakerSeparation)?'"speakers": ["Agent", "Client"],':"","\n      ").concat((null==a?void 0:a.sentimentAnalysis)?'"overallSentiment": "positive|neutral|negative"':"","\n      ").concat((null==a?void 0:a.generatePersona)?',"buyerPersona": {"buyerType": "Investor|First-Time Buyer|etc", "keyMotivations": [], "decisionTimeline": "timeline", "emotionalProfile": "profile"}':"","\n    }\n    \n\n    Ensure all content follows the specified ").concat((null==a?void 0:a.followUpTone)||"professional"," tone and incorporates property-specific insights.");let c="https://generateaifollowup-x5dsxztz7q-uc.a.run.app";console.log("\uD83D\uDD17 Using function URL:",c);let u=await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:s,sessionId:o||null,propertyContext:t||null,followUpTone:(null==a?void 0:a.followUpTone)||"professional",speakerSeparation:(null==a?void 0:a.speakerSeparation)||!1,sentimentAnalysis:(null==a?void 0:a.sentimentAnalysis)||!1,keywordExtraction:(null==a?void 0:a.keywordExtraction)||!1,generatePersona:(null==a?void 0:a.generatePersona)||!1,generateVoiceSummary:(null==a?void 0:a.generateVoiceSummary)||!1})});if(!u.ok){let e=await u.json().catch(()=>null);throw console.error("❌ Cloud Function error:",{status:u.status,statusText:u.statusText,error:e}),Error((null==e?void 0:e.message)||"Cloud Function request failed: ".concat(u.status))}let d=await u.json();if(!d.success||!d.data)throw Error("Invalid response format from Cloud Function");return console.log("✅ Enhanced AI follow-up generated successfully via backend"),console.log("\uD83D\uDCCA Metadata:",d.metadata),d.data}catch(o){console.error("❌ Error generating enhanced AI follow-up:",o);let e=t?" for the ".concat(t.propertyType.toLowerCase()," at ").concat(t.address):"";return{preferences:"Unable to analyze preferences from transcript. The AI service is temporarily unavailable. Error: ".concat(o instanceof Error?o.message:"Unknown error"),objections:"Unable to identify concerns from transcript. The AI service is temporarily unavailable. Error: ".concat(o instanceof Error?o.message:"Unknown error"),sms:"Hi ".concat(n,"! Thanks for visiting the property").concat(e," today. Let me know if you have any questions!"),email:"Hi ".concat(n,",\n\nThank you for taking the time to view the property").concat(e," today. I hope you found it interesting and that it meets some of your requirements.\n\nI'd love to hear your thoughts and answer any questions you might have. Please don't hesitate to reach out if you need any additional information or would like to schedule another viewing.\n\nLooking forward to hearing from you soon!\n\nBest regards,\n[Your Name]"),urgencyLevel:"medium",keyTopics:["property viewing","client feedback","follow-up required",...(null==t?void 0:t.propertyFeatures)||[]],recommendedActions:["Send follow-up message","Schedule callback","Prepare additional information"],tone:(null==a?void 0:a.followUpTone)||"professional",transcriptSegments:[],sentimentMap:[],keywordAnalysis:[],speakers:[],overallSentiment:"neutral",buyerPersona:null}}}}}]);